var AgentWebView=function(){"use strict";const e=new class{constructor(){this.eventCallbacks=new Map,this.pendingRequests=new Map,this.requestId=0,this._setupNativeReceiver()}_setupNativeReceiver(){window.AgentBridge={receiveMessage:e=>{const t="string"==typeof e?JSON.parse(e):e;this._handleIncomingMessage(t)},injectConfig:e=>{console.info("[AgentMessageBus] Config injected from Native"),this._emit("config-injected",e)},sendUserMessage:(e,t={})=>{console.info("[AgentMessageBus] User message received from Native"),this._emit("user-message",{message:e,context:t})}},window.handleNativeResponse=e=>{const t="string"==typeof e?JSON.parse(e):e;this._handleIncomingMessage(t)},window.addEventListener("message",e=>{try{const t="string"==typeof e.data?JSON.parse(e.data):e.data;"native"===t?.source&&this._handleIncomingMessage(t)}catch(e){}})}_handleIncomingMessage(e){const{requestId:t,type:r,payload:n,error:s}=e;if(t&&this.pendingRequests.has(t)){const{resolve:e,reject:r}=this.pendingRequests.get(t);return this.pendingRequests.delete(t),void(s?r(new Error(s)):e(n))}r&&this._emit(r,n)}_emit(e,t){(this.eventCallbacks.get(e)||[]).forEach(r=>{try{r(t)}catch(t){console.error(`[AgentMessageBus] Event handler error for "${e}":`,t)}})}_sendToNative(e,t){return new Promise((r,n)=>{const s=++this.requestId,o=setTimeout(()=>{this.pendingRequests.has(s)&&(this.pendingRequests.delete(s),n(new Error(`Native request timeout: ${e}`)))},3e4);this.pendingRequests.set(s,{resolve:e=>{clearTimeout(o),r(e)},reject:e=>{clearTimeout(o),n(e)}}),this._postMessage({requestId:s,type:e,payload:t})})}_postToNative(e,t){this._postMessage({type:e,payload:t})}_postMessage(e){const t=JSON.stringify(e);window.webkit?.messageHandlers?.AgentMessageBus?window.webkit.messageHandlers.AgentMessageBus.postMessage(t):window.NativeAgentBus?.postMessage?window.NativeAgentBus.postMessage(t):window.ReactNativeWebView?.postMessage?window.ReactNativeWebView.postMessage(t):console.warn("[AgentMessageBus] No native bridge available, message logged:",e)}notifyAgentReady(e){console.info("[AgentMessageBus] Notifying Native: Agent ready"),this._postToNative("agent-ready",{agentCard:e})}emitAgentEvent(e){this._postToNative("agent-event",e)}emitFullResponse(e){this._postToNative("full-response",e)}emitAgentError(e){console.error("[AgentMessageBus] Agent error:",e),this._postToNative("agent-error",{message:e.message,stack:e.stack,name:e.name})}on(e,t){return console.log(`agentbus set on ${e}`),this.eventCallbacks.has(e)||this.eventCallbacks.set(e,[]),this.eventCallbacks.get(e).push(t),this}off(e,t){const r=this.eventCallbacks.get(e);if(r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}return this}once(e,t){const r=n=>{this.off(e,r),t(n)};return this.on(e,r)}};class t{constructor(){this.taskHandlers=[]}onTaskRequest(t){this.taskHandlers.push(t),e.on("user-message",async({message:t,context:r})=>{console.info("[NativeTransport] Received user message");try{const e=this._buildRequestContext(t,r),n=this._createEventBus(e);for(const t of this.taskHandlers)await t(e,n)}catch(t){console.error("[NativeTransport] Handler error:",t),e.emitAgentError(t)}})}_buildRequestContext(e,t){const r=t.taskId||`task-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n=t.contextId||t.sessionId||r;return{taskId:r,contextId:n,userMessage:this._normalizeMessage(e,r,n),task:t.task||null,context:{requestedExtensions:t.requestedExtensions||[]}}}_normalizeMessage(e,t,r){return"string"==typeof e?{kind:"message",role:"user",messageId:`msg-${Date.now()}`,parts:[{kind:"text",text:e}],taskId:t,contextId:r}:(e.kind||(e.kind="message"),e.role||(e.role="user"),e.messageId||(e.messageId=`msg-${Date.now()}`),!e.parts&&e.text&&(e.parts=[{kind:"text",text:e.text}]),{...e,taskId:e.taskId||t,contextId:e.contextId||r})}_createEventBus(t){return{publish:r=>{const n={...r,taskId:r.taskId||t.taskId,contextId:r.contextId||t.contextId};e.emitAgentEvent(n)},finished:()=>{e.emitAgentEvent({type:"execution-finished",taskId:t.taskId,contextId:t.contextId})}}}}const r=new t;class n{constructor(e,t,r){this.agentCard=e,this.taskStore=t,this.agentExecutor=r,this.isStarted=!1}start(){this.isStarted?console.warn("[BrowserRequestHandler] Agent already started"):(r.onTaskRequest(async(t,r)=>{console.info("[BrowserRequestHandler] Processing task:",t.taskId);let n=t.task||{id:t.taskId,contextId:t.contextId,kind:"task",history:[],status:{state:"working",timestamp:(new Date).toISOString()}};!t.userMessage||n.history&&n.history.find(e=>e.messageId===t.userMessage.messageId)||(n.history||(n.history=[]),n.history.push(t.userMessage));const s={publish:e=>{r.publish(e),"task"===e.kind?n={...n,...e}:"status-update"===e.kind&&(n.status?n.status={...n.status,...e.status}:n.status=e.status,e.status.message&&"agent"===e.status.message.role&&(n.history||(n.history=[]),n.history.find(t=>t.messageId===e.status.message.messageId)||n.history.push(e.status.message)))},finished:()=>{const t={id:1,jsonrpc:"2.0",result:n};console.info("[BrowserRequestHandler] Sending full aggregated response"),e.emitFullResponse(t),r.finished()}};try{await this.agentExecutor.execute(t,s)}catch(e){console.error("[BrowserRequestHandler] Execution error:",e),s.publish({kind:"status-update",taskId:t.taskId,contextId:t.contextId,status:{state:"failed",message:{kind:"message",role:"agent",messageId:`error-${Date.now()}`,parts:[{kind:"text",text:`Error: ${e.message}`}]},timestamp:(new Date).toISOString()},final:!0}),s.finished()}}),e.notifyAgentReady(this.agentCard),this.isStarted=!0,console.info("[BrowserRequestHandler] Agent started:",this.agentCard.name))}getAgentCard(){return this.agentCard}isRunning(){return this.isStarted}}class s{constructor(){this.store=new Map}async load(e,t){return this.store.get(e)}async save(e,t){if(!e||!e.id)throw new Error("Task must have an id field");this.store.set(e.id,e)}async get(e){return this.load(e)}async delete(e){this.store.delete(e)}async list(){return Array.from(this.store.values())}async clear(){this.store.clear()}get size(){return this.store.size}}class o extends EventTarget{constructor(){super(),this.eventListeners=new Map,this.finishedListeners=new Map}publish(e){const t=new CustomEvent("event",{detail:e});this.dispatchEvent(t)}finished(){const e=new CustomEvent("finished",{detail:void 0});this.dispatchEvent(e)}on(e,t){const r=e=>{t(e.detail)};return this._trackListener(e,t,r),this.addEventListener(e,r),this}off(e,t){const r="finished"===e?this.finishedListeners:this.eventListeners,n=r.get(t);if(n&&n.length>0){const s=n.shift();this.removeEventListener(e,s),0===n.length&&r.delete(t)}return this}once(e,t){const r=n=>{this._untrackWrappedListener(e,t,r),t(n.detail)};return this._trackListener(e,t,r),this.addEventListener(e,r,{once:!0}),this}removeAllListeners(e){return e?this._removeAllForEvent(e):(this._removeAllForEvent("event"),this._removeAllForEvent("finished")),this}_trackListener(e,t,r){const n="finished"===e?this.finishedListeners:this.eventListeners;n.has(t)||n.set(t,[]),n.get(t).push(r)}_untrackWrappedListener(e,t,r){const n="finished"===e?this.finishedListeners:this.eventListeners,s=n.get(t);if(s){const e=s.indexOf(r);-1!==e&&s.splice(e,1),0===s.length&&n.delete(t)}}_removeAllForEvent(e){const t="finished"===e?this.finishedListeners:this.eventListeners;for(const[r,n]of t.entries())for(const t of n)this.removeEventListener(e,t);t.clear()}}class a{static fromObject(e){return new a(e.userMessage,e.taskId,e.contextId,e.task,e.referenceTasks,e.context)}toObject(){return{userMessage:this.userMessage,taskId:this.taskId,contextId:this.contextId,task:this.task,referenceTasks:this.referenceTasks,context:this.context}}}var i=Object.freeze({__proto__:null,BrowserRequestHandler:n,DefaultExecutionEventBus:o,DefaultExecutionEventBusManager:class{constructor(){this.taskIdToBus=new Map}createOrGetByTaskId(e){return this.taskIdToBus.has(e)||this.taskIdToBus.set(e,new o),this.taskIdToBus.get(e)}getByTaskId(e){return this.taskIdToBus.get(e)}cleanupByTaskId(e){const t=this.taskIdToBus.get(e);t&&(t.removeAllListeners(),this.taskIdToBus.delete(e))}},InMemoryTaskStore:s,NativeTransport:t,RequestContext:a,agentMessageBus:e,nativeTransport:r});const c=new class{constructor(){this.config={},this.listeners=[]}setConfig(e){this.config={...this.config,...e},this.listeners.forEach(e=>e(this.config))}get(e){return this.config[e]}getAPIConfig(){return{apiKey:this.get("GEMINI_API_KEY")||this.get("OPENROUTER_API_KEY")||this.get("DASHSCOPE_API_KEY"),baseURL:this.get("GEMINI_BASE_URL")||this.get("OPENROUTER_BASE_URL")||this.get("DASHSCOPE_BASE_URL"),model:this.get("GEMINI_MODEL")||this.get("OPENROUTER_MODEL")||this.get("DASHSCOPE_MODEL")}}onConfigChange(e){this.listeners.push(e)}},l="https://a2ui.org/a2a-extension/a2ui/v0.8";function d(e){return{kind:"data",data:e}}const u=[{name:"Golden Dragon Chinese Restaurant",cuisine:"Chinese",address:"123 Main Street, San Francisco, CA 94102",rating:4.5,priceRange:"$$",imageUrl:"/static/golden-dragon.jpg",description:"Authentic Cantonese cuisine with a modern twist"},{name:"Szechuan Palace",cuisine:"Chinese (Szechuan)",address:"456 Market St, San Francisco, CA 94103",rating:4.3,priceRange:"$$$",imageUrl:"/static/szechuan-palace.jpg",description:"Famous for spicy Szechuan dishes"},{name:"Dim Sum Garden",cuisine:"Chinese (Dim Sum)",address:"789 Grant Ave, San Francisco, CA 94108",rating:4.7,priceRange:"$$",imageUrl:"/static/dim-sum-garden.jpg",description:"Best dim sum in Chinatown"},{name:"Bamboo House",cuisine:"Chinese (Hunan)",address:"321 Kearny St, San Francisco, CA 94108",rating:4.2,priceRange:"$",imageUrl:"/static/bamboo-house.jpg",description:"Family-style Hunan cooking"},{name:"Dragon Pearl",cuisine:"Chinese (Seafood)",address:"555 Broadway, San Francisco, CA 94133",rating:4.6,priceRange:"$$$",imageUrl:"/static/dragon-pearl.jpg",description:"Fresh seafood with Hong Kong style"}];class p{constructor(e={}){this.delay=e.delay||500,this.useUI=!1!==e.useUI,this.streamChunks=e.streamChunks||3}async*stream(e,t){console.info(`[MockLLM] Processing query: "${e.substring(0,50)}..."`);for(let e=1;e<=this.streamChunks;e++)await this._sleep(this.delay),yield{is_task_complete:!1,updates:`Processing... (${e}/${this.streamChunks})`};const r=await this._generateResponse(e);await this._sleep(this.delay),yield{is_task_complete:!0,content:r}}async _generateResponse(e){const t=e.toLowerCase();if(e.startsWith("USER_WANTS_TO_BOOK:")){const t=e.match(/USER_WANTS_TO_BOOK:\s*(.+?),\s*Address:\s*(.+?),\s*ImageURL:\s*(.+)/);if(t){const[,e,r,n]=t,s=`Great choice! Here's the booking form for ${e}:`,o=JSON.stringify(((e,t,r)=>({type:"form",title:`Book ${e}`,fields:[{type:"number",name:"partySize",label:"Party Size",min:1,max:20,defaultValue:2},{type:"datetime",name:"reservationTime",label:"Reservation Time"},{type:"text",name:"dietary",label:"Dietary Requirements",placeholder:"Any allergies or dietary restrictions?"}],submitAction:{type:"submit",label:"Confirm Booking",actionName:"submit_booking",context:{restaurantName:e,address:t,imageUrl:r}}}))(e.trim(),r.trim(),n.trim()));return this.useUI?`${s}\n---a2ui_JSON---\n${o}`:s}}if(t.includes("submitted a booking for")){const t=this._parseBookingDetails(e),r="Your booking has been confirmed!",n=JSON.stringify((e=>({type:"confirmation",title:"Booking Confirmed!",message:`Your reservation at ${e.restaurantName} has been confirmed.`,details:[{label:"Restaurant",value:e.restaurantName},{label:"Party Size",value:`${e.partySize} people`},{label:"Time",value:e.reservationTime},{label:"Dietary",value:e.dietary||"None"}],confirmationNumber:`BK${Date.now().toString(36).toUpperCase()}`}))(t));return this.useUI?`${r}\n---a2ui_JSON---\n${n}`:`${r}\n\nRestaurant: ${t.restaurantName}\nParty Size: ${t.partySize}\nTime: ${t.reservationTime}`}if(t.includes("chinese")||t.includes("restaurant")||t.includes("find")){const e="I found some great Chinese restaurants for you:",t=JSON.stringify({type:"vertical_list",title:"Top Chinese Restaurants",items:u.map((e,t)=>({type:"restaurant_card",id:`restaurant-${t}`,name:e.name,cuisine:e.cuisine,address:e.address,rating:e.rating,priceRange:e.priceRange,imageUrl:e.imageUrl,description:e.description,actions:[{type:"button",label:"Book Now",actionName:"book_restaurant",context:{restaurantName:e.name,address:e.address,imageUrl:e.imageUrl}}]}))});return this.useUI?`${e}\n---a2ui_JSON---\n${t}`:`${e}\n\n${u.map((e,t)=>`${t+1}. ${e.name} - ${e.cuisine} (${e.rating}â˜…)\n   ${e.address}`).join("\n\n")}`}return"I'm the Restaurant Agent. I can help you find and book restaurants. Try asking me to find Chinese restaurants!"}_parseBookingDetails(e){const t={restaurantName:"Unknown Restaurant",partySize:"2",reservationTime:"Not specified",dietary:"None"},r=e.match(/booking for (.+?) for/);r&&(t.restaurantName=r[1]);const n=e.match(/for (\d+) people/);n&&(t.partySize=n[1]);const s=e.match(/at (.+?) with/);s&&(t.reservationTime=s[1]);const o=e.match(/requirements: (.+?)\.?$/);return o&&(t.dietary=o[1]),t}_sleep(e){return new Promise(t=>setTimeout(t,e))}}function h(e="",t=!0){return{baseUrl:e,useUI:t,provider:new p({useUI:t}),async*stream(e,t){yield*this.provider.stream(e,t)}}}class m{constructor(){this.messageHistory=[],this.eventHistory=[],this.agentInstance=null,this.mockMode=!1,this._setupEventListeners(),console.log("%cðŸ”§ DevTools Helper Loaded","color: #4CAF50; font-weight: bold; font-size: 14px;"),console.log("%cType `DevTools.help()` for available commands","color: #666;")}help(){console.log("\n%cðŸ“– DevTools Helper å‘½ä»¤æŒ‡å—\n\n%cåˆå§‹åŒ–å‘½ä»¤:\n  DevTools.init(config?)       åˆå§‹åŒ– Agent (å¯é€‰é…ç½®)\n  DevTools.initMock()          ä½¿ç”¨ Mock LLM åˆå§‹åŒ–ï¼ˆæ— éœ€ API Keyï¼‰\n\n%cæ¶ˆæ¯å‘½ä»¤:\n  DevTools.send(text)          å‘é€æ–‡æœ¬æ¶ˆæ¯\n  DevTools.sendRaw(message)    å‘é€åŽŸå§‹ A2A æ¶ˆæ¯å¯¹è±¡\n  DevTools.book(restaurantName) æ¨¡æ‹Ÿç‚¹å‡»é¢„è®¢æŒ‰é’®\n  DevTools.submitBooking(details) æäº¤é¢„è®¢è¡¨å•\n\n%cæŸ¥è¯¢å‘½ä»¤:\n  DevTools.status()            æŸ¥çœ‹ Agent çŠ¶æ€\n  DevTools.history()           æŸ¥çœ‹æ¶ˆæ¯åŽ†å²\n  DevTools.events()            æŸ¥çœ‹äº‹ä»¶åŽ†å²\n  DevTools.card()              æŸ¥çœ‹ Agent Card\n  DevTools.clear()             æ¸…ç©ºåŽ†å²è®°å½•\n\n%cè°ƒè¯•å‘½ä»¤:\n  DevTools.inspect(obj)        æ ¼å¼åŒ–æ‰“å°å¯¹è±¡\n  DevTools.mockRestaurants()   æŸ¥çœ‹æ¨¡æ‹Ÿé¤åŽ…æ•°æ®\n  DevTools.setMockMode(bool)   åˆ‡æ¢ Mock æ¨¡å¼\n  DevTools.simulateNativeCall(method, ...args) æ¨¡æ‹Ÿ Native è°ƒç”¨\n        ","color: #1976D2; font-weight: bold; font-size: 16px;","color: #F57C00; font-weight: bold;","color: #388E3C; font-weight: bold;","color: #7B1FA2; font-weight: bold;","color: #C62828; font-weight: bold;")}async init(e={}){if(void 0===window.AgentWebView)return void console.error("âŒ AgentWebView not loaded. Make sure the bundle is loaded first.");const t={OPENROUTER_API_KEY:"",OPENROUTER_BASE_URL:"https://openrouter.ai/api/v1",OPENROUTER_MODEL:"google/gemini-2.5-flash",MOCK_MODE:!1,...e};console.log("%cðŸš€ Initializing Agent...","color: #2196F3;");try{const e=await window.AgentWebView.initialize(t);return this.agentInstance=window.AgentWebView,this.mockMode=t.MOCK_MODE,console.log("%câœ… Agent Initialized","color: #4CAF50; font-weight: bold;"),console.log("Session ID:",e.sessionId),console.log("Agent Card:",e.agentCard?.name),e}catch(e){throw console.error("âŒ Initialization failed:",e),e}}async initMock(){return console.log("%cðŸŽ­ Initializing with Mock LLM (no API key needed)...","color: #FF9800;"),window.__mockAgent=h("",!0),this.init({MOCK_MODE:!0,baseUrl:""})}async send(e){if(!this._checkInitialized())return;console.log("%cðŸ“¤ Sending:","color: #2196F3;",e);const t={kind:"message",role:"user",parts:[{kind:"text",text:e}],timestamp:(new Date).toISOString()};this.messageHistory.push({direction:"sent",message:t});try{await this.agentInstance.sendTextMessage(e,!0)}catch(e){console.error("âŒ Send failed:",e)}}async sendRaw(e){this._checkInitialized()&&(console.log("%cðŸ“¤ Sending raw message:","color: #2196F3;",e),this.messageHistory.push({direction:"sent",message:e}),window.AgentBridge.sendUserMessage(e,{sessionId:this.agentInstance.sessionId,requestedExtensions:["https://purl.org/nickel/a2ui"]}))}async book(e){if(!this._checkInitialized())return;const t=u.find(t=>t.name.toLowerCase().includes(e.toLowerCase()))||u[0];console.log("%cðŸ½ï¸ Booking restaurant:","color: #FF5722;",t.name),await this.agentInstance.sendUIEvent("book_restaurant",{restaurantName:t.name,address:t.address,imageUrl:t.imageUrl})}async submitBooking(e={}){if(!this._checkInitialized())return;const t={restaurantName:e.restaurantName||"Golden Dragon",partySize:e.partySize||"4",reservationTime:e.reservationTime||"7:00 PM",dietary:e.dietary||"No shellfish",...e};console.log("%cðŸ“ Submitting booking:","color: #4CAF50;",t),await this.agentInstance.sendUIEvent("submit_booking",t)}status(){if(!this._checkInitialized())return{initialized:!1};const e=this.agentInstance.getStatus();return console.table(e),e}history(){return console.log("%cðŸ“œ Message History:","color: #9C27B0; font-weight: bold;"),0===this.messageHistory.length?(console.log("  (empty)"),[]):(this.messageHistory.forEach((e,t)=>{const r="sent"===e.direction?"ðŸ“¤":"ðŸ“¥",n="sent"===e.direction?"#2196F3":"#4CAF50";console.log(`%c${r} [${t}] ${e.direction}:`,`color: ${n};`,e.message)}),this.messageHistory)}events(){return console.log("%cðŸŽ¯ Event History:","color: #E91E63; font-weight: bold;"),0===this.eventHistory.length?(console.log("  (empty)"),[]):(this.eventHistory.forEach((e,t)=>{console.log(`%c[${t}] ${e.type||e.kind}:`,"color: #E91E63;",e)}),this.eventHistory)}card(){if(!this._checkInitialized())return null;const e=this.agentInstance.getAgentCard();return console.log("%cðŸƒ Agent Card:","color: #673AB7; font-weight: bold;"),console.log(JSON.stringify(e,null,2)),e}clear(){this.messageHistory=[],this.eventHistory=[],console.log("%cðŸ§¹ History cleared","color: #607D8B;")}inspect(e){return console.log("%cðŸ” Inspect:","color: #00BCD4; font-weight: bold;"),console.dir(e,{depth:null}),e}mockRestaurants(){return console.log("%cðŸœ Mock Restaurant Data:","color: #FF9800; font-weight: bold;"),console.table(u.map(e=>({name:e.name,cuisine:e.cuisine,rating:e.rating,price:e.priceRange}))),u}setMockMode(e){this.mockMode=e,console.log("%cðŸŽ­ Mock mode: "+(e?"ON":"OFF"),`color: ${e?"#FF9800":"#607D8B"};`)}simulateNativeCall(e,...t){if(console.log(`%cðŸ“± Simulating Native call: ${e}`,"color: #795548;",t),window.AgentBridge&&"function"==typeof window.AgentBridge[e])return window.AgentBridge[e](...t);console.error(`âŒ Method not found: AgentBridge.${e}`)}_setupEventListeners(){if("undefined"!=typeof window){const e=()=>{window.AgentWebView?window.AgentWebView.on("agent-event",e=>{console.log("%cðŸ“¥ Agent Event:","color: #4CAF50;",e),this.eventHistory.push(e),this.messageHistory.push({direction:"received",message:e})}):setTimeout(e,100)};e()}}_checkInitialized(){return!(!this.agentInstance||!this.agentInstance.isInitialized)||(console.error("âŒ Agent not initialized. Run DevTools.init() or DevTools.initMock() first."),!1)}}const f=new m;"undefined"!=typeof window&&(window.DevTools=f);var g=Object.freeze({__proto__:null,DevToolsHelper:m,MOCK_RESTAURANTS:u,MockLLMProvider:p,createMockAgent:h,devTools:f});let y=null;function v(){return`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}class b{constructor(){this.requestHandler=null,this.sessionId=v(),this.isInitialized=!1,this.agentCard=null,e.on("config-injected",e=>{console.info("[AgentWebView] Config injected from Native"),c.setConfig(e)})}async initialize(t){try{console.info("[AgentWebView] Initializing..."),c.setConfig(t);const e=t.baseUrl||t.BASE_URL||"";if(!y){const e=await Promise.resolve().then(function(){return Kr});y=e.default||e.RestaurantAgentExecutor}this.agentCard=this._buildAgentCard(e);const r=new s,o=new y(e);return this.requestHandler=new n(this.agentCard,r,o),this.requestHandler.start(),this.isInitialized=!0,console.info("[AgentWebView] Initialized successfully"),{success:!0,sessionId:this.sessionId,agentCard:this.agentCard}}catch(t){return console.error("[AgentWebView] Initialization failed:",t),e.emitAgentError(t),{success:!1,error:t.message}}}_buildAgentCard(e){return{capabilities:{extensions:[{description:"Provides agent driven UI using the A2UI JSON format.",uri:"https://a2ui.org/a2a-extension/a2ui/v0.8"}],streaming:!0},defaultInputModes:["text","text/plain"],defaultOutputModes:["text","text/plain"],description:"This agent helps find restaurants based on user criteria.",name:"Restaurant Agent",preferredTransport:"JSONRPC",protocolVersion:"0.3.0",skills:[{description:"Helps find restaurants based on user criteria (e.g., cuisine, location).",examples:["Find me the top 10 chinese restaurants in the US"],id:"find_restaurants",name:"Find Restaurants Tool",tags:["restaurant","finder"]}],url:e,version:"1.0.0"}}async sendTextMessage(e,t=!0){if(!this.isInitialized)throw new Error("Agent not initialized");const r={kind:"message",role:"user",parts:[{kind:"text",text:e}]},n={sessionId:this.sessionId,requestedExtensions:t?[l]:[]};window.AgentBridge.sendUserMessage(r,n)}async sendUIEvent(e,t={}){if(!this.isInitialized)throw new Error("Agent not initialized");const r={kind:"message",role:"user",parts:[{kind:"data",data:{userAction:{actionName:e,context:t}}}]};window.AgentBridge.sendUserMessage(r,{sessionId:this.sessionId,requestedExtensions:[l]})}async sendCommonEvent(e){window.AgentBridge.sendUserMessage(e,{sessionId:this.sessionId,requestedExtensions:[l]})}resetSession(){return this.sessionId=v(),console.info(`[AgentWebView] Session reset: ${this.sessionId}`),{sessionId:this.sessionId}}on(t,r){return e.on(t,r),this}off(t,r){return e.off(t,r),this}getStatus(){return{initialized:this.isInitialized,sessionId:this.sessionId,agentCard:this.agentCard}}getAgentCard(){return this.agentCard}}const $=new b;function w(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}$.agentWebView=$,$.AgentWebViewInstance=b,$.configManager=c,$.agentMessageBus=e,$.A2UI_EXTENSION_URL=l,Object.assign($,i),Object.assign($,g);var _,k={exports:{}},S={},E={},I={},x={},N={},P={};function T(){return _||(_=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.regexpCode=e.getEsmExportName=e.getProperty=e.safeStringify=e.stringify=e.strConcat=e.addCodeArg=e.str=e._=e.nil=e._Code=e.Name=e.IDENTIFIER=e._CodeOrName=void 0;class t{}e._CodeOrName=t,e.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class r extends t{constructor(t){if(super(),!e.IDENTIFIER.test(t))throw new Error("CodeGen: name must be a valid identifier");this.str=t}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}e.Name=r;class n extends t{constructor(e){super(),this._items="string"==typeof e?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const e=this._items[0];return""===e||'""'===e}get str(){var e;return null!==(e=this._str)&&void 0!==e?e:this._str=this._items.reduce((e,t)=>`${e}${t}`,"")}get names(){var e;return null!==(e=this._names)&&void 0!==e?e:this._names=this._items.reduce((e,t)=>(t instanceof r&&(e[t.str]=(e[t.str]||0)+1),e),{})}}function s(e,...t){const r=[e[0]];let s=0;for(;s<t.length;)i(r,t[s]),r.push(e[++s]);return new n(r)}e._Code=n,e.nil=new n(""),e._=s;const o=new n("+");function a(e,...t){const r=[l(e[0])];let s=0;for(;s<t.length;)r.push(o),i(r,t[s]),r.push(o,l(e[++s]));return function(e){let t=1;for(;t<e.length-1;){if(e[t]===o){const r=c(e[t-1],e[t+1]);if(void 0!==r){e.splice(t-1,3,r);continue}e[t++]="+"}t++}}(r),new n(r)}function i(e,t){var s;t instanceof n?e.push(...t._items):t instanceof r?e.push(t):e.push("number"==typeof(s=t)||"boolean"==typeof s||null===s?s:l(Array.isArray(s)?s.join(","):s))}function c(e,t){if('""'===t)return e;if('""'===e)return t;if("string"==typeof e){if(t instanceof r||'"'!==e[e.length-1])return;return"string"!=typeof t?`${e.slice(0,-1)}${t}"`:'"'===t[0]?e.slice(0,-1)+t.slice(1):void 0}return"string"!=typeof t||'"'!==t[0]||e instanceof r?void 0:`"${e}${t.slice(1)}`}function l(e){return JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}e.str=a,e.addCodeArg=i,e.strConcat=function(e,t){return t.emptyStr()?e:e.emptyStr()?t:a`${e}${t}`},e.stringify=function(e){return new n(l(e))},e.safeStringify=l,e.getProperty=function(t){return"string"==typeof t&&e.IDENTIFIER.test(t)?new n(`.${t}`):s`[${t}]`},e.getEsmExportName=function(t){if("string"==typeof t&&e.IDENTIFIER.test(t))return new n(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)},e.regexpCode=function(e){return new n(e.toString())}}(P)),P}var j,C,O={};function R(){return j||(j=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ValueScope=e.ValueScopeName=e.Scope=e.varKinds=e.UsedValueState=void 0;const t=T();class r extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}}var n;!function(e){e[e.Started=0]="Started",e[e.Completed=1]="Completed"}(n||(e.UsedValueState=n={})),e.varKinds={const:new t.Name("const"),let:new t.Name("let"),var:new t.Name("var")};class s{constructor({prefixes:e,parent:t}={}){this._names={},this._prefixes=e,this._parent=t}toName(e){return e instanceof t.Name?e:this.name(e)}name(e){return new t.Name(this._newName(e))}_newName(e){return`${e}${(this._names[e]||this._nameGroup(e)).index++}`}_nameGroup(e){var t,r;if((null===(r=null===(t=this._parent)||void 0===t?void 0:t._prefixes)||void 0===r?void 0:r.has(e))||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}}e.Scope=s;class o extends t.Name{constructor(e,t){super(t),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=t._`.${new t.Name(r)}[${n}]`}}e.ValueScopeName=o;const a=t._`\n`;e.ValueScope=class extends s{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?a:t.nil}}get(){return this._scope}name(e){return new o(e,this._newName(e))}value(e,t){var r;if(void 0===t.ref)throw new Error("CodeGen: ref must be passed in value");const n=this.toName(e),{prefix:s}=n,o=null!==(r=t.key)&&void 0!==r?r:t.ref;let a=this._values[s];if(a){const e=a.get(o);if(e)return e}else a=this._values[s]=new Map;a.set(o,n);const i=this._scope[s]||(this._scope[s]=[]),c=i.length;return i[c]=t.ref,n.setValue(t,{property:s,itemIndex:c}),n}getValue(e,t){const r=this._values[e];if(r)return r.get(t)}scopeRefs(e,r=this._values){return this._reduceValues(r,r=>{if(void 0===r.scopePath)throw new Error(`CodeGen: name "${r}" has no value`);return t._`${e}${r.scopePath}`})}scopeCode(e=this._values,t,r){return this._reduceValues(e,e=>{if(void 0===e.value)throw new Error(`CodeGen: name "${e}" has no value`);return e.value.code},t,r)}_reduceValues(s,o,a={},i){let c=t.nil;for(const l in s){const d=s[l];if(!d)continue;const u=a[l]=a[l]||new Map;d.forEach(s=>{if(u.has(s))return;u.set(s,n.Started);let a=o(s);if(a){const r=this.opts.es5?e.varKinds.var:e.varKinds.const;c=t._`${c}${r} ${s} = ${a};${this.opts._n}`}else{if(!(a=null==i?void 0:i(s)))throw new r(s);c=t._`${c}${a}${this.opts._n}`}u.set(s,n.Completed)})}return c}}}(O)),O}function A(){return C||(C=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.or=e.and=e.not=e.CodeGen=e.operators=e.varKinds=e.ValueScopeName=e.ValueScope=e.Scope=e.Name=e.regexpCode=e.stringify=e.getProperty=e.nil=e.strConcat=e.str=e._=void 0;const t=T(),r=R();var n=T();Object.defineProperty(e,"_",{enumerable:!0,get:function(){return n._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return n.str}}),Object.defineProperty(e,"strConcat",{enumerable:!0,get:function(){return n.strConcat}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return n.nil}}),Object.defineProperty(e,"getProperty",{enumerable:!0,get:function(){return n.getProperty}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return n.stringify}}),Object.defineProperty(e,"regexpCode",{enumerable:!0,get:function(){return n.regexpCode}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return n.Name}});var s=R();Object.defineProperty(e,"Scope",{enumerable:!0,get:function(){return s.Scope}}),Object.defineProperty(e,"ValueScope",{enumerable:!0,get:function(){return s.ValueScope}}),Object.defineProperty(e,"ValueScopeName",{enumerable:!0,get:function(){return s.ValueScopeName}}),Object.defineProperty(e,"varKinds",{enumerable:!0,get:function(){return s.varKinds}}),e.operators={GT:new t._Code(">"),GTE:new t._Code(">="),LT:new t._Code("<"),LTE:new t._Code("<="),EQ:new t._Code("==="),NEQ:new t._Code("!=="),NOT:new t._Code("!"),OR:new t._Code("||"),AND:new t._Code("&&"),ADD:new t._Code("+")};class o{optimizeNodes(){return this}optimizeNames(e,t){return this}}class a extends o{constructor(e,t,r){super(),this.varKind=e,this.name=t,this.rhs=r}render({es5:e,_n:t}){const n=e?r.varKinds.var:this.varKind,s=void 0===this.rhs?"":` = ${this.rhs}`;return`${n} ${this.name}${s};`+t}optimizeNames(e,t){if(e[this.name.str])return this.rhs&&(this.rhs=P(this.rhs,e,t)),this}get names(){return this.rhs instanceof t._CodeOrName?this.rhs.names:{}}}class i extends o{constructor(e,t,r){super(),this.lhs=e,this.rhs=t,this.sideEffects=r}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof t.Name)||e[this.lhs.str]||this.sideEffects)return this.rhs=P(this.rhs,e,r),this}get names(){return N(this.lhs instanceof t.Name?{}:{...this.lhs.names},this.rhs)}}class c extends i{constructor(e,t,r,n){super(e,r,n),this.op=t}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}}class l extends o{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}}class d extends o{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}}class u extends o{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}}class p extends o{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,t){return this.code=P(this.code,e,t),this}get names(){return this.code instanceof t._CodeOrName?this.code.names:{}}}class h extends o{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((t,r)=>t+r.render(e),"")}optimizeNodes(){const{nodes:e}=this;let t=e.length;for(;t--;){const r=e[t].optimizeNodes();Array.isArray(r)?e.splice(t,1,...r):r?e[t]=r:e.splice(t,1)}return e.length>0?this:void 0}optimizeNames(e,t){const{nodes:r}=this;let n=r.length;for(;n--;){const s=r[n];s.optimizeNames(e,t)||(j(e,s.names),r.splice(n,1))}return r.length>0?this:void 0}get names(){return this.nodes.reduce((e,t)=>x(e,t.names),{})}}class m extends h{render(e){return"{"+e._n+super.render(e)+"}"+e._n}}class f extends h{}class g extends m{}g.kind="else";class y extends m{constructor(e,t){super(t),this.condition=e}render(e){let t=`if(${this.condition})`+super.render(e);return this.else&&(t+="else "+this.else.render(e)),t}optimizeNodes(){super.optimizeNodes();const e=this.condition;if(!0===e)return this.nodes;let t=this.else;if(t){const e=t.optimizeNodes();t=this.else=Array.isArray(e)?new g(e):e}return t?!1===e?t instanceof y?t:t.nodes:this.nodes.length?this:new y(C(e),t instanceof y?[t]:t.nodes):!1!==e&&this.nodes.length?this:void 0}optimizeNames(e,t){var r;if(this.else=null===(r=this.else)||void 0===r?void 0:r.optimizeNames(e,t),super.optimizeNames(e,t)||this.else)return this.condition=P(this.condition,e,t),this}get names(){const e=super.names;return N(e,this.condition),this.else&&x(e,this.else.names),e}}y.kind="if";class v extends m{}v.kind="for";class b extends v{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,t){if(super.optimizeNames(e,t))return this.iteration=P(this.iteration,e,t),this}get names(){return x(super.names,this.iteration.names)}}class $ extends v{constructor(e,t,r,n){super(),this.varKind=e,this.name=t,this.from=r,this.to=n}render(e){const t=e.es5?r.varKinds.var:this.varKind,{name:n,from:s,to:o}=this;return`for(${t} ${n}=${s}; ${n}<${o}; ${n}++)`+super.render(e)}get names(){const e=N(super.names,this.from);return N(e,this.to)}}class w extends v{constructor(e,t,r,n){super(),this.loop=e,this.varKind=t,this.name=r,this.iterable=n}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,t){if(super.optimizeNames(e,t))return this.iterable=P(this.iterable,e,t),this}get names(){return x(super.names,this.iterable.names)}}class _ extends m{constructor(e,t,r){super(),this.name=e,this.args=t,this.async=r}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}}_.kind="func";class k extends h{render(e){return"return "+super.render(e)}}k.kind="return";class S extends m{render(e){let t="try"+super.render(e);return this.catch&&(t+=this.catch.render(e)),this.finally&&(t+=this.finally.render(e)),t}optimizeNodes(){var e,t;return super.optimizeNodes(),null===(e=this.catch)||void 0===e||e.optimizeNodes(),null===(t=this.finally)||void 0===t||t.optimizeNodes(),this}optimizeNames(e,t){var r,n;return super.optimizeNames(e,t),null===(r=this.catch)||void 0===r||r.optimizeNames(e,t),null===(n=this.finally)||void 0===n||n.optimizeNames(e,t),this}get names(){const e=super.names;return this.catch&&x(e,this.catch.names),this.finally&&x(e,this.finally.names),e}}class E extends m{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}}E.kind="catch";class I extends m{render(e){return"finally"+super.render(e)}}I.kind="finally";function x(e,t){for(const r in t)e[r]=(e[r]||0)+(t[r]||0);return e}function N(e,r){return r instanceof t._CodeOrName?x(e,r.names):e}function P(e,r,n){return e instanceof t.Name?o(e):(s=e)instanceof t._Code&&s._items.some(e=>e instanceof t.Name&&1===r[e.str]&&void 0!==n[e.str])?new t._Code(e._items.reduce((e,r)=>(r instanceof t.Name&&(r=o(r)),r instanceof t._Code?e.push(...r._items):e.push(r),e),[])):e;var s;function o(e){const t=n[e.str];return void 0===t||1!==r[e.str]?e:(delete r[e.str],t)}}function j(e,t){for(const r in t)e[r]=(e[r]||0)-(t[r]||0)}function C(e){return"boolean"==typeof e||"number"==typeof e||null===e?!e:t._`!${U(e)}`}e.CodeGen=class{constructor(e,t={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...t,_n:t.lines?"\n":""},this._extScope=e,this._scope=new r.Scope({parent:e}),this._nodes=[new f]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,t){const r=this._extScope.value(e,t);return(this._values[r.prefix]||(this._values[r.prefix]=new Set)).add(r),r}getScopeValue(e,t){return this._extScope.getValue(e,t)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,t,r,n){const s=this._scope.toName(t);return void 0!==r&&n&&(this._constants[s.str]=r),this._leafNode(new a(e,s,r)),s}const(e,t,n){return this._def(r.varKinds.const,e,t,n)}let(e,t,n){return this._def(r.varKinds.let,e,t,n)}var(e,t,n){return this._def(r.varKinds.var,e,t,n)}assign(e,t,r){return this._leafNode(new i(e,t,r))}add(t,r){return this._leafNode(new c(t,e.operators.ADD,r))}code(e){return"function"==typeof e?e():e!==t.nil&&this._leafNode(new p(e)),this}object(...e){const r=["{"];for(const[n,s]of e)r.length>1&&r.push(","),r.push(n),(n!==s||this.opts.es5)&&(r.push(":"),(0,t.addCodeArg)(r,s));return r.push("}"),new t._Code(r)}if(e,t,r){if(this._blockNode(new y(e)),t&&r)this.code(t).else().code(r).endIf();else if(t)this.code(t).endIf();else if(r)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new y(e))}else(){return this._elseNode(new g)}endIf(){return this._endBlockNode(y,g)}_for(e,t){return this._blockNode(e),t&&this.code(t).endFor(),this}for(e,t){return this._for(new b(e),t)}forRange(e,t,n,s,o=(this.opts.es5?r.varKinds.var:r.varKinds.let)){const a=this._scope.toName(e);return this._for(new $(o,a,t,n),()=>s(a))}forOf(e,n,s,o=r.varKinds.const){const a=this._scope.toName(e);if(this.opts.es5){const e=n instanceof t.Name?n:this.var("_arr",n);return this.forRange("_i",0,t._`${e}.length`,r=>{this.var(a,t._`${e}[${r}]`),s(a)})}return this._for(new w("of",o,a,n),()=>s(a))}forIn(e,n,s,o=(this.opts.es5?r.varKinds.var:r.varKinds.const)){if(this.opts.ownProperties)return this.forOf(e,t._`Object.keys(${n})`,s);const a=this._scope.toName(e);return this._for(new w("in",o,a,n),()=>s(a))}endFor(){return this._endBlockNode(v)}label(e){return this._leafNode(new l(e))}break(e){return this._leafNode(new d(e))}return(e){const t=new k;if(this._blockNode(t),this.code(e),1!==t.nodes.length)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(k)}try(e,t,r){if(!t&&!r)throw new Error('CodeGen: "try" without "catch" and "finally"');const n=new S;if(this._blockNode(n),this.code(e),t){const e=this.name("e");this._currNode=n.catch=new E(e),t(e)}return r&&(this._currNode=n.finally=new I,this.code(r)),this._endBlockNode(E,I)}throw(e){return this._leafNode(new u(e))}block(e,t){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(t),this}endBlock(e){const t=this._blockStarts.pop();if(void 0===t)throw new Error("CodeGen: not in self-balancing block");const r=this._nodes.length-t;if(r<0||void 0!==e&&r!==e)throw new Error(`CodeGen: wrong number of nodes: ${r} vs ${e} expected`);return this._nodes.length=t,this}func(e,r=t.nil,n,s){return this._blockNode(new _(e,r,n)),s&&this.code(s).endFunc(),this}endFunc(){return this._endBlockNode(_)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,t){const r=this._currNode;if(r instanceof e||t&&r instanceof t)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${t?`${e.kind}/${t.kind}`:e.kind}"`)}_elseNode(e){const t=this._currNode;if(!(t instanceof y))throw new Error('CodeGen: "else" without "if"');return this._currNode=t.else=e,this}get _root(){return this._nodes[0]}get _currNode(){const e=this._nodes;return e[e.length-1]}set _currNode(e){const t=this._nodes;t[t.length-1]=e}},e.not=C;const O=M(e.operators.AND);e.and=function(...e){return e.reduce(O)};const A=M(e.operators.OR);function M(e){return(r,n)=>r===t.nil?n:n===t.nil?r:t._`${U(r)} ${e} ${U(n)}`}function U(e){return e instanceof t.Name?e:t._`(${e})`}e.or=function(...e){return e.reduce(A)}}(N)),N}var M,U={};function D(){if(M)return U;M=1,Object.defineProperty(U,"__esModule",{value:!0}),U.checkStrictMode=U.getErrorPath=U.Type=U.useFunc=U.setEvaluated=U.evaluatedPropsToName=U.mergeEvaluated=U.eachItem=U.unescapeJsonPointer=U.escapeJsonPointer=U.escapeFragment=U.unescapeFragment=U.schemaRefOrVal=U.schemaHasRulesButRef=U.schemaHasRules=U.checkUnknownRules=U.alwaysValidSchema=U.toHash=void 0;const e=A(),t=T();function r(e,t=e.schema){const{opts:r,self:n}=e;if(!r.strictSchema)return;if("boolean"==typeof t)return;const s=n.RULES.keywords;for(const r in t)s[r]||u(e,`unknown keyword: "${r}"`)}function n(e,t){if("boolean"==typeof e)return!e;for(const r in e)if(t[r])return!0;return!1}function s(e){return"number"==typeof e?`${e}`:e.replace(/~/g,"~0").replace(/\//g,"~1")}function o(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function a({mergeNames:t,mergeToName:r,mergeValues:n,resultToName:s}){return(o,a,i,c)=>{const l=void 0===i?a:i instanceof e.Name?(a instanceof e.Name?t(o,a,i):r(o,a,i),i):a instanceof e.Name?(r(o,i,a),a):n(a,i);return c!==e.Name||l instanceof e.Name?l:s(o,l)}}function i(t,r){if(!0===r)return t.var("props",!0);const n=t.var("props",e._`{}`);return void 0!==r&&c(t,n,r),n}function c(t,r,n){Object.keys(n).forEach(n=>t.assign(e._`${r}${(0,e.getProperty)(n)}`,!0))}U.toHash=function(e){const t={};for(const r of e)t[r]=!0;return t},U.alwaysValidSchema=function(e,t){return"boolean"==typeof t?t:0===Object.keys(t).length||(r(e,t),!n(t,e.self.RULES.all))},U.checkUnknownRules=r,U.schemaHasRules=n,U.schemaHasRulesButRef=function(e,t){if("boolean"==typeof e)return!e;for(const r in e)if("$ref"!==r&&t.all[r])return!0;return!1},U.schemaRefOrVal=function({topSchemaRef:t,schemaPath:r},n,s,o){if(!o){if("number"==typeof n||"boolean"==typeof n)return n;if("string"==typeof n)return e._`${n}`}return e._`${t}${r}${(0,e.getProperty)(s)}`},U.unescapeFragment=function(e){return o(decodeURIComponent(e))},U.escapeFragment=function(e){return encodeURIComponent(s(e))},U.escapeJsonPointer=s,U.unescapeJsonPointer=o,U.eachItem=function(e,t){if(Array.isArray(e))for(const r of e)t(r);else t(e)},U.mergeEvaluated={props:a({mergeNames:(t,r,n)=>t.if(e._`${n} !== true && ${r} !== undefined`,()=>{t.if(e._`${r} === true`,()=>t.assign(n,!0),()=>t.assign(n,e._`${n} || {}`).code(e._`Object.assign(${n}, ${r})`))}),mergeToName:(t,r,n)=>t.if(e._`${n} !== true`,()=>{!0===r?t.assign(n,!0):(t.assign(n,e._`${n} || {}`),c(t,n,r))}),mergeValues:(e,t)=>!0===e||{...e,...t},resultToName:i}),items:a({mergeNames:(t,r,n)=>t.if(e._`${n} !== true && ${r} !== undefined`,()=>t.assign(n,e._`${r} === true ? true : ${n} > ${r} ? ${n} : ${r}`)),mergeToName:(t,r,n)=>t.if(e._`${n} !== true`,()=>t.assign(n,!0===r||e._`${n} > ${r} ? ${n} : ${r}`)),mergeValues:(e,t)=>!0===e||Math.max(e,t),resultToName:(e,t)=>e.var("items",t)})},U.evaluatedPropsToName=i,U.setEvaluated=c;const l={};var d;function u(e,t,r=e.opts.strictSchema){if(r){if(t=`strict mode: ${t}`,!0===r)throw new Error(t);e.self.logger.warn(t)}}return U.useFunc=function(e,r){return e.scopeValue("func",{ref:r,code:l[r.code]||(l[r.code]=new t._Code(r.code))})},function(e){e[e.Num=0]="Num",e[e.Str=1]="Str"}(d||(U.Type=d={})),U.getErrorPath=function(t,r,n){if(t instanceof e.Name){const s=r===d.Num;return n?s?e._`"[" + ${t} + "]"`:e._`"['" + ${t} + "']"`:s?e._`"/" + ${t}`:e._`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return n?(0,e.getProperty)(t).toString():"/"+s(t)},U.checkStrictMode=u,U}var L,q,z,F={};function V(){if(L)return F;L=1,Object.defineProperty(F,"__esModule",{value:!0});const e=A(),t={data:new e.Name("data"),valCxt:new e.Name("valCxt"),instancePath:new e.Name("instancePath"),parentData:new e.Name("parentData"),parentDataProperty:new e.Name("parentDataProperty"),rootData:new e.Name("rootData"),dynamicAnchors:new e.Name("dynamicAnchors"),vErrors:new e.Name("vErrors"),errors:new e.Name("errors"),this:new e.Name("this"),self:new e.Name("self"),scope:new e.Name("scope"),json:new e.Name("json"),jsonPos:new e.Name("jsonPos"),jsonLen:new e.Name("jsonLen"),jsonPart:new e.Name("jsonPart")};return F.default=t,F}function B(){return q||(q=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.extendErrors=e.resetErrorsCount=e.reportExtraError=e.reportError=e.keyword$DataError=e.keywordError=void 0;const t=A(),r=D(),n=V();function s(e,r){const s=e.const("err",r);e.if(t._`${n.default.vErrors} === null`,()=>e.assign(n.default.vErrors,t._`[${s}]`),t._`${n.default.vErrors}.push(${s})`),e.code(t._`${n.default.errors}++`)}function o(e,r){const{gen:n,validateName:s,schemaEnv:o}=e;o.$async?n.throw(t._`new ${e.ValidationError}(${r})`):(n.assign(t._`${s}.errors`,r),n.return(!1))}e.keywordError={message:({keyword:e})=>t.str`must pass "${e}" keyword validation`},e.keyword$DataError={message:({keyword:e,schemaType:r})=>r?t.str`"${e}" keyword must be ${r} ($data)`:t.str`"${e}" keyword is invalid ($data)`},e.reportError=function(r,n=e.keywordError,a,c){const{it:l}=r,{gen:d,compositeRule:u,allErrors:p}=l,h=i(r,n,a);(null!=c?c:u||p)?s(d,h):o(l,t._`[${h}]`)},e.reportExtraError=function(t,r=e.keywordError,a){const{it:c}=t,{gen:l,compositeRule:d,allErrors:u}=c;s(l,i(t,r,a)),d||u||o(c,n.default.vErrors)},e.resetErrorsCount=function(e,r){e.assign(n.default.errors,r),e.if(t._`${n.default.vErrors} !== null`,()=>e.if(r,()=>e.assign(t._`${n.default.vErrors}.length`,r),()=>e.assign(n.default.vErrors,null)))},e.extendErrors=function({gen:e,keyword:r,schemaValue:s,data:o,errsCount:a,it:i}){if(void 0===a)throw new Error("ajv implementation error");const c=e.name("err");e.forRange("i",a,n.default.errors,a=>{e.const(c,t._`${n.default.vErrors}[${a}]`),e.if(t._`${c}.instancePath === undefined`,()=>e.assign(t._`${c}.instancePath`,(0,t.strConcat)(n.default.instancePath,i.errorPath))),e.assign(t._`${c}.schemaPath`,t.str`${i.errSchemaPath}/${r}`),i.opts.verbose&&(e.assign(t._`${c}.schema`,s),e.assign(t._`${c}.data`,o))})};const a={keyword:new t.Name("keyword"),schemaPath:new t.Name("schemaPath"),params:new t.Name("params"),propertyName:new t.Name("propertyName"),message:new t.Name("message"),schema:new t.Name("schema"),parentSchema:new t.Name("parentSchema")};function i(e,r,s){const{createErrors:o}=e.it;return!1===o?t._`{}`:function(e,r,s={}){const{gen:o,it:i}=e,d=[c(i,s),l(e,s)];return function(e,{params:r,message:s},o){const{keyword:i,data:c,schemaValue:l,it:d}=e,{opts:u,propertyName:p,topSchemaRef:h,schemaPath:m}=d;o.push([a.keyword,i],[a.params,"function"==typeof r?r(e):r||t._`{}`]),u.messages&&o.push([a.message,"function"==typeof s?s(e):s]);u.verbose&&o.push([a.schema,l],[a.parentSchema,t._`${h}${m}`],[n.default.data,c]);p&&o.push([a.propertyName,p])}(e,r,d),o.object(...d)}(e,r,s)}function c({errorPath:e},{instancePath:s}){const o=s?t.str`${e}${(0,r.getErrorPath)(s,r.Type.Str)}`:e;return[n.default.instancePath,(0,t.strConcat)(n.default.instancePath,o)]}function l({keyword:e,it:{errSchemaPath:n}},{schemaPath:s,parentSchema:o}){let i=o?n:t.str`${n}/${e}`;return s&&(i=t.str`${i}${(0,r.getErrorPath)(s,r.Type.Str)}`),[a.schemaPath,i]}}(x)),x}var H,K={},J={};function G(){if(H)return J;H=1,Object.defineProperty(J,"__esModule",{value:!0}),J.getRules=J.isJSONType=void 0;const e=new Set(["string","number","integer","boolean","null","object","array"]);return J.isJSONType=function(t){return"string"==typeof t&&e.has(t)},J.getRules=function(){const e={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...e,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},e.number,e.string,e.array,e.object],post:{rules:[]},all:{},keywords:{}}},J}var W,Y,X={};function Q(){if(W)return X;function e(e,r){return r.rules.some(r=>t(e,r))}function t(e,t){var r;return void 0!==e[t.keyword]||(null===(r=t.definition.implements)||void 0===r?void 0:r.some(t=>void 0!==e[t]))}return W=1,Object.defineProperty(X,"__esModule",{value:!0}),X.shouldUseRule=X.shouldUseGroup=X.schemaHasRulesForType=void 0,X.schemaHasRulesForType=function({schema:t,self:r},n){const s=r.RULES.types[n];return s&&!0!==s&&e(t,s)},X.shouldUseGroup=e,X.shouldUseRule=t,X}function Z(){if(Y)return K;Y=1,Object.defineProperty(K,"__esModule",{value:!0}),K.reportTypeError=K.checkDataTypes=K.checkDataType=K.coerceAndCheckDataType=K.getJSONTypes=K.getSchemaTypes=K.DataType=void 0;const e=G(),t=Q(),r=B(),n=A(),s=D();var o;function a(t){const r=Array.isArray(t)?t:t?[t]:[];if(r.every(e.isJSONType))return r;throw new Error("type must be JSONType or JSONType[]: "+r.join(","))}!function(e){e[e.Correct=0]="Correct",e[e.Wrong=1]="Wrong"}(o||(K.DataType=o={})),K.getSchemaTypes=function(e){const t=a(e.type);if(t.includes("null")){if(!1===e.nullable)throw new Error("type: null contradicts nullable: false")}else{if(!t.length&&void 0!==e.nullable)throw new Error('"nullable" cannot be used without "type"');!0===e.nullable&&t.push("null")}return t},K.getJSONTypes=a,K.coerceAndCheckDataType=function(e,r){const{gen:s,data:a,opts:c}=e,d=function(e,t){return t?e.filter(e=>i.has(e)||"array"===t&&"array"===e):[]}(r,c.coerceTypes),p=r.length>0&&!(0===d.length&&1===r.length&&(0,t.schemaHasRulesForType)(e,r[0]));if(p){const t=l(r,a,c.strictNumbers,o.Wrong);s.if(t,()=>{d.length?function(e,t,r){const{gen:s,data:o,opts:a}=e,c=s.let("dataType",n._`typeof ${o}`),d=s.let("coerced",n._`undefined`);"array"===a.coerceTypes&&s.if(n._`${c} == 'object' && Array.isArray(${o}) && ${o}.length == 1`,()=>s.assign(o,n._`${o}[0]`).assign(c,n._`typeof ${o}`).if(l(t,o,a.strictNumbers),()=>s.assign(d,o)));s.if(n._`${d} !== undefined`);for(const e of r)(i.has(e)||"array"===e&&"array"===a.coerceTypes)&&p(e);function p(e){switch(e){case"string":return void s.elseIf(n._`${c} == "number" || ${c} == "boolean"`).assign(d,n._`"" + ${o}`).elseIf(n._`${o} === null`).assign(d,n._`""`);case"number":return void s.elseIf(n._`${c} == "boolean" || ${o} === null
              || (${c} == "string" && ${o} && ${o} == +${o})`).assign(d,n._`+${o}`);case"integer":return void s.elseIf(n._`${c} === "boolean" || ${o} === null
              || (${c} === "string" && ${o} && ${o} == +${o} && !(${o} % 1))`).assign(d,n._`+${o}`);case"boolean":return void s.elseIf(n._`${o} === "false" || ${o} === 0 || ${o} === null`).assign(d,!1).elseIf(n._`${o} === "true" || ${o} === 1`).assign(d,!0);case"null":return s.elseIf(n._`${o} === "" || ${o} === 0 || ${o} === false`),void s.assign(d,null);case"array":s.elseIf(n._`${c} === "string" || ${c} === "number"
              || ${c} === "boolean" || ${o} === null`).assign(d,n._`[${o}]`)}}s.else(),u(e),s.endIf(),s.if(n._`${d} !== undefined`,()=>{s.assign(o,d),function({gen:e,parentData:t,parentDataProperty:r},s){e.if(n._`${t} !== undefined`,()=>e.assign(n._`${t}[${r}]`,s))}(e,d)})}(e,r,d):u(e)})}return p};const i=new Set(["string","number","integer","boolean","null"]);function c(e,t,r,s=o.Correct){const a=s===o.Correct?n.operators.EQ:n.operators.NEQ;let i;switch(e){case"null":return n._`${t} ${a} null`;case"array":i=n._`Array.isArray(${t})`;break;case"object":i=n._`${t} && typeof ${t} == "object" && !Array.isArray(${t})`;break;case"integer":i=c(n._`!(${t} % 1) && !isNaN(${t})`);break;case"number":i=c();break;default:return n._`typeof ${t} ${a} ${e}`}return s===o.Correct?i:(0,n.not)(i);function c(e=n.nil){return(0,n.and)(n._`typeof ${t} == "number"`,e,r?n._`isFinite(${t})`:n.nil)}}function l(e,t,r,o){if(1===e.length)return c(e[0],t,r,o);let a;const i=(0,s.toHash)(e);if(i.array&&i.object){const e=n._`typeof ${t} != "object"`;a=i.null?e:n._`!${t} || ${e}`,delete i.null,delete i.array,delete i.object}else a=n.nil;i.number&&delete i.integer;for(const e in i)a=(0,n.and)(a,c(e,t,r,o));return a}K.checkDataType=c,K.checkDataTypes=l;const d={message:({schema:e})=>`must be ${e}`,params:({schema:e,schemaValue:t})=>"string"==typeof e?n._`{type: ${e}}`:n._`{type: ${t}}`};function u(e){const t=function(e){const{gen:t,data:r,schema:n}=e,o=(0,s.schemaRefOrVal)(e,n,"type");return{gen:t,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:e}}(e);(0,r.reportError)(t,d)}return K.reportTypeError=u,K}var ee,te={};var re,ne,se={},oe={};function ae(){if(re)return oe;re=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.validateUnion=oe.validateArray=oe.usePattern=oe.callValidateCode=oe.schemaProperties=oe.allSchemaProperties=oe.noPropertyInData=oe.propertyInData=oe.isOwnProperty=oe.hasPropFunc=oe.reportMissingProp=oe.checkMissingProp=oe.checkReportMissingProp=void 0;const e=A(),t=D(),r=V(),n=D();function s(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:e._`Object.prototype.hasOwnProperty`})}function o(t,r,n){return e._`${s(t)}.call(${r}, ${n})`}function a(t,r,n,s){const a=e._`${r}${(0,e.getProperty)(n)} === undefined`;return s?(0,e.or)(a,(0,e.not)(o(t,r,n))):a}function i(e){return e?Object.keys(e).filter(e=>"__proto__"!==e):[]}oe.checkReportMissingProp=function(t,r){const{gen:n,data:s,it:o}=t;n.if(a(n,s,r,o.opts.ownProperties),()=>{t.setParams({missingProperty:e._`${r}`},!0),t.error()})},oe.checkMissingProp=function({gen:t,data:r,it:{opts:n}},s,o){return(0,e.or)(...s.map(s=>(0,e.and)(a(t,r,s,n.ownProperties),e._`${o} = ${s}`)))},oe.reportMissingProp=function(e,t){e.setParams({missingProperty:t},!0),e.error()},oe.hasPropFunc=s,oe.isOwnProperty=o,oe.propertyInData=function(t,r,n,s){const a=e._`${r}${(0,e.getProperty)(n)} !== undefined`;return s?e._`${a} && ${o(t,r,n)}`:a},oe.noPropertyInData=a,oe.allSchemaProperties=i,oe.schemaProperties=function(e,r){return i(r).filter(n=>!(0,t.alwaysValidSchema)(e,r[n]))},oe.callValidateCode=function({schemaCode:t,data:n,it:{gen:s,topSchemaRef:o,schemaPath:a,errorPath:i},it:c},l,d,u){const p=u?e._`${t}, ${n}, ${o}${a}`:n,h=[[r.default.instancePath,(0,e.strConcat)(r.default.instancePath,i)],[r.default.parentData,c.parentData],[r.default.parentDataProperty,c.parentDataProperty],[r.default.rootData,r.default.rootData]];c.opts.dynamicRef&&h.push([r.default.dynamicAnchors,r.default.dynamicAnchors]);const m=e._`${p}, ${s.object(...h)}`;return d!==e.nil?e._`${l}.call(${d}, ${m})`:e._`${l}(${m})`};const c=e._`new RegExp`;return oe.usePattern=function({gen:t,it:{opts:r}},s){const o=r.unicodeRegExp?"u":"",{regExp:a}=r.code,i=a(s,o);return t.scopeValue("pattern",{key:i.toString(),ref:i,code:e._`${"new RegExp"===a.code?c:(0,n.useFunc)(t,a)}(${s}, ${o})`})},oe.validateArray=function(r){const{gen:n,data:s,keyword:o,it:a}=r,i=n.name("valid");if(a.allErrors){const e=n.let("valid",!0);return c(()=>n.assign(e,!1)),e}return n.var(i,!0),c(()=>n.break()),i;function c(a){const c=n.const("len",e._`${s}.length`);n.forRange("i",0,c,s=>{r.subschema({keyword:o,dataProp:s,dataPropType:t.Type.Num},i),n.if((0,e.not)(i),a)})}},oe.validateUnion=function(r){const{gen:n,schema:s,keyword:o,it:a}=r;if(!Array.isArray(s))throw new Error("ajv implementation error");if(s.some(e=>(0,t.alwaysValidSchema)(a,e))&&!a.opts.unevaluated)return;const i=n.let("valid",!1),c=n.name("_valid");n.block(()=>s.forEach((t,s)=>{const a=r.subschema({keyword:o,schemaProp:s,compositeRule:!0},c);n.assign(i,e._`${i} || ${c}`);r.mergeValidEvaluated(a,c)||n.if((0,e.not)(i))})),r.result(i,()=>r.reset(),()=>r.error(!0))},oe}function ie(){if(ne)return se;ne=1,Object.defineProperty(se,"__esModule",{value:!0}),se.validateKeywordUsage=se.validSchemaType=se.funcKeywordCode=se.macroKeywordCode=void 0;const e=A(),t=V(),r=ae(),n=B();function s(t){const{gen:r,data:n,it:s}=t;r.if(s.parentData,()=>r.assign(n,e._`${s.parentData}[${s.parentDataProperty}]`))}function o(t,r,n){if(void 0===n)throw new Error(`keyword "${r}" failed to compile`);return t.scopeValue("keyword","function"==typeof n?{ref:n}:{ref:n,code:(0,e.stringify)(n)})}return se.macroKeywordCode=function(t,r){const{gen:n,keyword:s,schema:a,parentSchema:i,it:c}=t,l=r.macro.call(c.self,a,i,c),d=o(n,s,l);!1!==c.opts.validateSchema&&c.self.validateSchema(l,!0);const u=n.name("valid");t.subschema({schema:l,schemaPath:e.nil,errSchemaPath:`${c.errSchemaPath}/${s}`,topSchemaRef:d,compositeRule:!0},u),t.pass(u,()=>t.error(!0))},se.funcKeywordCode=function(a,i){var c;const{gen:l,keyword:d,schema:u,parentSchema:p,$data:h,it:m}=a;!function({schemaEnv:e},t){if(t.async&&!e.$async)throw new Error("async keyword in sync schema")}(m,i);const f=!h&&i.compile?i.compile.call(m.self,u,p,m):i.validate,g=o(l,d,f),y=l.let("valid");function v(n=(i.async?e._`await `:e.nil)){const s=m.opts.passContext?t.default.this:t.default.self,o=!("compile"in i&&!h||!1===i.schema);l.assign(y,e._`${n}${(0,r.callValidateCode)(a,g,s,o)}`,i.modifying)}function b(t){var r;l.if((0,e.not)(null!==(r=i.valid)&&void 0!==r?r:y),t)}a.block$data(y,function(){if(!1===i.errors)v(),i.modifying&&s(a),b(()=>a.error());else{const r=i.async?function(){const t=l.let("ruleErrs",null);return l.try(()=>v(e._`await `),r=>l.assign(y,!1).if(e._`${r} instanceof ${m.ValidationError}`,()=>l.assign(t,e._`${r}.errors`),()=>l.throw(r))),t}():function(){const t=e._`${g}.errors`;return l.assign(t,null),v(e.nil),t}();i.modifying&&s(a),b(()=>function(r,s){const{gen:o}=r;o.if(e._`Array.isArray(${s})`,()=>{o.assign(t.default.vErrors,e._`${t.default.vErrors} === null ? ${s} : ${t.default.vErrors}.concat(${s})`).assign(t.default.errors,e._`${t.default.vErrors}.length`),(0,n.extendErrors)(r)},()=>r.error())}(a,r))}}),a.ok(null!==(c=i.valid)&&void 0!==c?c:y)},se.validSchemaType=function(e,t,r=!1){return!t.length||t.some(t=>"array"===t?Array.isArray(e):"object"===t?e&&"object"==typeof e&&!Array.isArray(e):typeof e==t||r&&void 0===e)},se.validateKeywordUsage=function({schema:e,opts:t,self:r,errSchemaPath:n},s,o){if(Array.isArray(s.keyword)?!s.keyword.includes(o):s.keyword!==o)throw new Error("ajv implementation error");const a=s.dependencies;if(null==a?void 0:a.some(t=>!Object.prototype.hasOwnProperty.call(e,t)))throw new Error(`parent schema must have dependencies of ${o}: ${a.join(",")}`);if(s.validateSchema){if(!s.validateSchema(e[o])){const e=`keyword "${o}" value is invalid at path "${n}": `+r.errorsText(s.validateSchema.errors);if("log"!==t.validateSchema)throw new Error(e);r.logger.error(e)}}},se}var ce,le={};var de,ue,pe={};function he(){return ue||(ue=1,de=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,s,o;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(s=n;0!==s--;)if(!e(t[s],r[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(o=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(s=n;0!==s--;)if(!Object.prototype.hasOwnProperty.call(r,o[s]))return!1;for(s=n;0!==s--;){var a=o[s];if(!e(t[a],r[a]))return!1}return!0}return t!=t&&r!=r}),de}var me,fe,ge,ye={exports:{}};function ve(){if(me)return ye.exports;me=1;var e=ye.exports=function(e,r,n){"function"==typeof r&&(n=r,r={}),t(r,"function"==typeof(n=r.cb||n)?n:n.pre||function(){},n.post||function(){},e,"",e)};function t(n,s,o,a,i,c,l,d,u,p){if(a&&"object"==typeof a&&!Array.isArray(a)){for(var h in s(a,i,c,l,d,u,p),a){var m=a[h];if(Array.isArray(m)){if(h in e.arrayKeywords)for(var f=0;f<m.length;f++)t(n,s,o,m[f],i+"/"+h+"/"+f,c,i,h,a,f)}else if(h in e.propsKeywords){if(m&&"object"==typeof m)for(var g in m)t(n,s,o,m[g],i+"/"+h+"/"+r(g),c,i,h,a,g)}else(h in e.keywords||n.allKeys&&!(h in e.skipKeywords))&&t(n,s,o,m,i+"/"+h,c,i,h,a)}o(a,i,c,l,d,u,p)}}function r(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}return e.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},e.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},e.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},e.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},ye.exports}function be(){if(fe)return pe;fe=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.getSchemaRefs=pe.resolveUrl=pe.normalizeId=pe._getFullPath=pe.getFullPath=pe.inlineRef=void 0;const e=D(),t=he(),r=ve(),n=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);pe.inlineRef=function(e,t=!0){return"boolean"==typeof e||(!0===t?!o(e):!!t&&a(e)<=t)};const s=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function o(e){for(const t in e){if(s.has(t))return!0;const r=e[t];if(Array.isArray(r)&&r.some(o))return!0;if("object"==typeof r&&o(r))return!0}return!1}function a(t){let r=0;for(const s in t){if("$ref"===s)return 1/0;if(r++,!n.has(s)&&("object"==typeof t[s]&&(0,e.eachItem)(t[s],e=>r+=a(e)),r===1/0))return 1/0}return r}function i(e,t="",r){!1!==r&&(t=d(t));const n=e.parse(t);return c(e,n)}function c(e,t){return e.serialize(t).split("#")[0]+"#"}pe.getFullPath=i,pe._getFullPath=c;const l=/#\/?$/;function d(e){return e?e.replace(l,""):""}pe.normalizeId=d,pe.resolveUrl=function(e,t,r){return r=d(r),e.resolve(t,r)};const u=/^[a-z_][-a-z0-9._]*$/i;return pe.getSchemaRefs=function(e,n){if("boolean"==typeof e)return{};const{schemaId:s,uriResolver:o}=this.opts,a=d(e[s]||n),c={"":a},l=i(o,a,!1),p={},h=new Set;return r(e,{allKeys:!0},(e,t,r,n)=>{if(void 0===n)return;const o=l+t;let a=c[n];function i(t){const r=this.opts.uriResolver.resolve;if(t=d(a?r(a,t):t),h.has(t))throw f(t);h.add(t);let n=this.refs[t];return"string"==typeof n&&(n=this.refs[n]),"object"==typeof n?m(e,n.schema,t):t!==d(o)&&("#"===t[0]?(m(e,p[t],t),p[t]=e):this.refs[t]=o),t}function g(e){if("string"==typeof e){if(!u.test(e))throw new Error(`invalid anchor "${e}"`);i.call(this,`#${e}`)}}"string"==typeof e[s]&&(a=i.call(this,e[s])),g.call(this,e.$anchor),g.call(this,e.$dynamicAnchor),c[t]=a}),p;function m(e,r,n){if(void 0!==r&&!t(e,r))throw f(n)}function f(e){return new Error(`reference "${e}" resolves to more than one schema`)}},pe}function $e(){if(ge)return E;ge=1,Object.defineProperty(E,"__esModule",{value:!0}),E.getData=E.KeywordCxt=E.validateFunctionCode=void 0;const e=function(){if(z)return I;z=1,Object.defineProperty(I,"__esModule",{value:!0}),I.boolOrEmptySchema=I.topBoolOrEmptySchema=void 0;const e=B(),t=A(),r=V(),n={message:"boolean schema is false"};function s(t,r){const{gen:s,data:o}=t,a={gen:s,keyword:"false schema",data:o,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,e.reportError)(a,n,void 0,r)}return I.topBoolOrEmptySchema=function(e){const{gen:n,schema:o,validateName:a}=e;!1===o?s(e,!1):"object"==typeof o&&!0===o.$async?n.return(r.default.data):(n.assign(t._`${a}.errors`,null),n.return(!0))},I.boolOrEmptySchema=function(e,t){const{gen:r,schema:n}=e;!1===n?(r.var(t,!1),s(e)):r.var(t,!0)},I}(),t=Z(),r=Q(),n=Z(),s=function(){if(ee)return te;ee=1,Object.defineProperty(te,"__esModule",{value:!0}),te.assignDefaults=void 0;const e=A(),t=D();function r(r,n,s){const{gen:o,compositeRule:a,data:i,opts:c}=r;if(void 0===s)return;const l=e._`${i}${(0,e.getProperty)(n)}`;if(a)return void(0,t.checkStrictMode)(r,`default is ignored for: ${l}`);let d=e._`${l} === undefined`;"empty"===c.useDefaults&&(d=e._`${d} || ${l} === null || ${l} === ""`),o.if(d,e._`${l} = ${(0,e.stringify)(s)}`)}return te.assignDefaults=function(e,t){const{properties:n,items:s}=e.schema;if("object"===t&&n)for(const t in n)r(e,t,n[t].default);else"array"===t&&Array.isArray(s)&&s.forEach((t,n)=>r(e,n,t.default))},te}(),o=ie(),a=function(){if(ce)return le;ce=1,Object.defineProperty(le,"__esModule",{value:!0}),le.extendSubschemaMode=le.extendSubschemaData=le.getSubschema=void 0;const e=A(),t=D();return le.getSubschema=function(r,{keyword:n,schemaProp:s,schema:o,schemaPath:a,errSchemaPath:i,topSchemaRef:c}){if(void 0!==n&&void 0!==o)throw new Error('both "keyword" and "schema" passed, only one allowed');if(void 0!==n){const o=r.schema[n];return void 0===s?{schema:o,schemaPath:e._`${r.schemaPath}${(0,e.getProperty)(n)}`,errSchemaPath:`${r.errSchemaPath}/${n}`}:{schema:o[s],schemaPath:e._`${r.schemaPath}${(0,e.getProperty)(n)}${(0,e.getProperty)(s)}`,errSchemaPath:`${r.errSchemaPath}/${n}/${(0,t.escapeFragment)(s)}`}}if(void 0!==o){if(void 0===a||void 0===i||void 0===c)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:o,schemaPath:a,topSchemaRef:c,errSchemaPath:i}}throw new Error('either "keyword" or "schema" must be passed')},le.extendSubschemaData=function(r,n,{dataProp:s,dataPropType:o,data:a,dataTypes:i,propertyName:c}){if(void 0!==a&&void 0!==s)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:l}=n;if(void 0!==s){const{errorPath:a,dataPathArr:i,opts:c}=n;d(l.let("data",e._`${n.data}${(0,e.getProperty)(s)}`,!0)),r.errorPath=e.str`${a}${(0,t.getErrorPath)(s,o,c.jsPropertySyntax)}`,r.parentDataProperty=e._`${s}`,r.dataPathArr=[...i,r.parentDataProperty]}function d(e){r.data=e,r.dataLevel=n.dataLevel+1,r.dataTypes=[],n.definedProperties=new Set,r.parentData=n.data,r.dataNames=[...n.dataNames,e]}void 0!==a&&(d(a instanceof e.Name?a:l.let("data",a,!0)),void 0!==c&&(r.propertyName=c)),i&&(r.dataTypes=i)},le.extendSubschemaMode=function(e,{jtdDiscriminator:t,jtdMetadata:r,compositeRule:n,createErrors:s,allErrors:o}){void 0!==n&&(e.compositeRule=n),void 0!==s&&(e.createErrors=s),void 0!==o&&(e.allErrors=o),e.jtdDiscriminator=t,e.jtdMetadata=r},le}(),i=A(),c=V(),l=be(),d=D(),u=B();function p({gen:e,validateName:t,schema:r,schemaEnv:n,opts:s},o){s.code.es5?e.func(t,i._`${c.default.data}, ${c.default.valCxt}`,n.$async,()=>{e.code(i._`"use strict"; ${h(r,s)}`),function(e,t){e.if(c.default.valCxt,()=>{e.var(c.default.instancePath,i._`${c.default.valCxt}.${c.default.instancePath}`),e.var(c.default.parentData,i._`${c.default.valCxt}.${c.default.parentData}`),e.var(c.default.parentDataProperty,i._`${c.default.valCxt}.${c.default.parentDataProperty}`),e.var(c.default.rootData,i._`${c.default.valCxt}.${c.default.rootData}`),t.dynamicRef&&e.var(c.default.dynamicAnchors,i._`${c.default.valCxt}.${c.default.dynamicAnchors}`)},()=>{e.var(c.default.instancePath,i._`""`),e.var(c.default.parentData,i._`undefined`),e.var(c.default.parentDataProperty,i._`undefined`),e.var(c.default.rootData,c.default.data),t.dynamicRef&&e.var(c.default.dynamicAnchors,i._`{}`)})}(e,s),e.code(o)}):e.func(t,i._`${c.default.data}, ${function(e){return i._`{${c.default.instancePath}="", ${c.default.parentData}, ${c.default.parentDataProperty}, ${c.default.rootData}=${c.default.data}${e.dynamicRef?i._`, ${c.default.dynamicAnchors}={}`:i.nil}}={}`}(s)}`,n.$async,()=>e.code(h(r,s)).code(o))}function h(e,t){const r="object"==typeof e&&e[t.schemaId];return r&&(t.code.source||t.code.process)?i._`/*# sourceURL=${r} */`:i.nil}function m(t,r){g(t)&&(y(t),f(t))?function(e,t){const{schema:r,gen:n,opts:s}=e;s.$comment&&r.$comment&&b(e);(function(e){const t=e.schema[e.opts.schemaId];t&&(e.baseId=(0,l.resolveUrl)(e.opts.uriResolver,e.baseId,t))})(e),function(e){if(e.schema.$async&&!e.schemaEnv.$async)throw new Error("async schema in sync schema")}(e);const o=n.const("_errs",c.default.errors);v(e,o),n.var(t,i._`${o} === ${c.default.errors}`)}(t,r):(0,e.boolOrEmptySchema)(t,r)}function f({schema:e,self:t}){if("boolean"==typeof e)return!e;for(const r in e)if(t.RULES.all[r])return!0;return!1}function g(e){return"boolean"!=typeof e.schema}function y(e){(0,d.checkUnknownRules)(e),function(e){const{schema:t,errSchemaPath:r,opts:n,self:s}=e;t.$ref&&n.ignoreKeywordsWithRef&&(0,d.schemaHasRulesButRef)(t,s.RULES)&&s.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}(e)}function v(e,r){if(e.opts.jtd)return $(e,[],!1,r);const n=(0,t.getSchemaTypes)(e.schema);$(e,n,!(0,t.coerceAndCheckDataType)(e,n),r)}function b({gen:e,schemaEnv:t,schema:r,errSchemaPath:n,opts:s}){const o=r.$comment;if(!0===s.$comment)e.code(i._`${c.default.self}.logger.log(${o})`);else if("function"==typeof s.$comment){const r=i.str`${n}/$comment`,s=e.scopeValue("root",{ref:t.root});e.code(i._`${c.default.self}.opts.$comment(${o}, ${r}, ${s}.schema)`)}}function $(e,t,s,o){const{gen:a,schema:l,data:u,allErrors:p,opts:h,self:m}=e,{RULES:f}=m;function g(d){(0,r.shouldUseGroup)(l,d)&&(d.type?(a.if((0,n.checkDataType)(d.type,u,h.strictNumbers)),w(e,d),1===t.length&&t[0]===d.type&&s&&(a.else(),(0,n.reportTypeError)(e)),a.endIf()):w(e,d),p||a.if(i._`${c.default.errors} === ${o||0}`))}!l.$ref||!h.ignoreKeywordsWithRef&&(0,d.schemaHasRulesButRef)(l,f)?(h.jtd||function(e,t){if(e.schemaEnv.meta||!e.opts.strictTypes)return;(function(e,t){if(!t.length)return;if(!e.dataTypes.length)return void(e.dataTypes=t);t.forEach(t=>{k(e.dataTypes,t)||S(e,`type "${t}" not allowed by context "${e.dataTypes.join(",")}"`)}),function(e,t){const r=[];for(const n of e.dataTypes)k(t,n)?r.push(n):t.includes("integer")&&"number"===n&&r.push("integer");e.dataTypes=r}(e,t)})(e,t),e.opts.allowUnionTypes||function(e,t){t.length>1&&(2!==t.length||!t.includes("null"))&&S(e,"use allowUnionTypes to allow union type keyword")}(e,t);!function(e,t){const n=e.self.RULES.all;for(const s in n){const o=n[s];if("object"==typeof o&&(0,r.shouldUseRule)(e.schema,o)){const{type:r}=o.definition;r.length&&!r.some(e=>_(t,e))&&S(e,`missing type "${r.join(",")}" for keyword "${s}"`)}}}(e,e.dataTypes)}(e,t),a.block(()=>{for(const e of f.rules)g(e);g(f.post)})):a.block(()=>N(e,"$ref",f.all.$ref.definition))}function w(e,t){const{gen:n,schema:o,opts:{useDefaults:a}}=e;a&&(0,s.assignDefaults)(e,t.type),n.block(()=>{for(const n of t.rules)(0,r.shouldUseRule)(o,n)&&N(e,n.keyword,n.definition,t.type)})}function _(e,t){return e.includes(t)||"number"===t&&e.includes("integer")}function k(e,t){return e.includes(t)||"integer"===t&&e.includes("number")}function S(e,t){t+=` at "${e.schemaEnv.baseId+e.errSchemaPath}" (strictTypes)`,(0,d.checkStrictMode)(e,t,e.opts.strictTypes)}E.validateFunctionCode=function(t){g(t)&&(y(t),f(t))?function(e){const{schema:t,opts:r,gen:n}=e;p(e,()=>{r.$comment&&t.$comment&&b(e),function(e){const{schema:t,opts:r}=e;void 0!==t.default&&r.useDefaults&&r.strictSchema&&(0,d.checkStrictMode)(e,"default is ignored in the schema root")}(e),n.let(c.default.vErrors,null),n.let(c.default.errors,0),r.unevaluated&&function(e){const{gen:t,validateName:r}=e;e.evaluated=t.const("evaluated",i._`${r}.evaluated`),t.if(i._`${e.evaluated}.dynamicProps`,()=>t.assign(i._`${e.evaluated}.props`,i._`undefined`)),t.if(i._`${e.evaluated}.dynamicItems`,()=>t.assign(i._`${e.evaluated}.items`,i._`undefined`))}(e),v(e),function(e){const{gen:t,schemaEnv:r,validateName:n,ValidationError:s,opts:o}=e;r.$async?t.if(i._`${c.default.errors} === 0`,()=>t.return(c.default.data),()=>t.throw(i._`new ${s}(${c.default.vErrors})`)):(t.assign(i._`${n}.errors`,c.default.vErrors),o.unevaluated&&function({gen:e,evaluated:t,props:r,items:n}){r instanceof i.Name&&e.assign(i._`${t}.props`,r);n instanceof i.Name&&e.assign(i._`${t}.items`,n)}(e),t.return(i._`${c.default.errors} === 0`))}(e)})}(t):p(t,()=>(0,e.topBoolOrEmptySchema)(t))};class x{constructor(e,t,r){if((0,o.validateKeywordUsage)(e,t,r),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=r,this.data=e.data,this.schema=e.schema[r],this.$data=t.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,d.schemaRefOrVal)(e,this.schema,r,this.$data),this.schemaType=t.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=t,this.$data)this.schemaCode=e.gen.const("vSchema",j(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,o.validSchemaType)(this.schema,t.schemaType,t.allowUndefined))throw new Error(`${r} value must be ${JSON.stringify(t.schemaType)}`);("code"in t?t.trackErrors:!1!==t.errors)&&(this.errsCount=e.gen.const("_errs",c.default.errors))}result(e,t,r){this.failResult((0,i.not)(e),t,r)}failResult(e,t,r){this.gen.if(e),r?r():this.error(),t?(this.gen.else(),t(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,t){this.failResult((0,i.not)(e),void 0,t)}fail(e){if(void 0===e)return this.error(),void(this.allErrors||this.gen.if(!1));this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);const{schemaCode:t}=this;this.fail(i._`${t} !== undefined && (${(0,i.or)(this.invalid$data(),e)})`)}error(e,t,r){if(t)return this.setParams(t),this._error(e,r),void this.setParams({});this._error(e,r)}_error(e,t){(e?u.reportExtraError:u.reportError)(this,this.def.error,t)}$dataError(){(0,u.reportError)(this,this.def.$dataError||u.keyword$DataError)}reset(){if(void 0===this.errsCount)throw new Error('add "trackErrors" to keyword definition');(0,u.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,t){t?Object.assign(this.params,e):this.params=e}block$data(e,t,r=i.nil){this.gen.block(()=>{this.check$data(e,r),t()})}check$data(e=i.nil,t=i.nil){if(!this.$data)return;const{gen:r,schemaCode:n,schemaType:s,def:o}=this;r.if((0,i.or)(i._`${n} === undefined`,t)),e!==i.nil&&r.assign(e,!0),(s.length||o.validateSchema)&&(r.elseIf(this.invalid$data()),this.$dataError(),e!==i.nil&&r.assign(e,!1)),r.else()}invalid$data(){const{gen:e,schemaCode:t,schemaType:r,def:s,it:o}=this;return(0,i.or)(function(){if(r.length){if(!(t instanceof i.Name))throw new Error("ajv implementation error");const e=Array.isArray(r)?r:[r];return i._`${(0,n.checkDataTypes)(e,t,o.opts.strictNumbers,n.DataType.Wrong)}`}return i.nil}(),function(){if(s.validateSchema){const r=e.scopeValue("validate$data",{ref:s.validateSchema});return i._`!${r}(${t})`}return i.nil}())}subschema(e,t){const r=(0,a.getSubschema)(this.it,e);(0,a.extendSubschemaData)(r,this.it,e),(0,a.extendSubschemaMode)(r,e);const n={...this.it,...r,items:void 0,props:void 0};return m(n,t),n}mergeEvaluated(e,t){const{it:r,gen:n}=this;r.opts.unevaluated&&(!0!==r.props&&void 0!==e.props&&(r.props=d.mergeEvaluated.props(n,e.props,r.props,t)),!0!==r.items&&void 0!==e.items&&(r.items=d.mergeEvaluated.items(n,e.items,r.items,t)))}mergeValidEvaluated(e,t){const{it:r,gen:n}=this;if(r.opts.unevaluated&&(!0!==r.props||!0!==r.items))return n.if(t,()=>this.mergeEvaluated(e,i.Name)),!0}}function N(e,t,r,n){const s=new x(e,r,t);"code"in r?r.code(s,n):s.$data&&r.validate?(0,o.funcKeywordCode)(s,r):"macro"in r?(0,o.macroKeywordCode)(s,r):(r.compile||r.validate)&&(0,o.funcKeywordCode)(s,r)}E.KeywordCxt=x;const P=/^\/(?:[^~]|~0|~1)*$/,T=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function j(e,{dataLevel:t,dataNames:r,dataPathArr:n}){let s,o;if(""===e)return c.default.rootData;if("/"===e[0]){if(!P.test(e))throw new Error(`Invalid JSON-pointer: ${e}`);s=e,o=c.default.rootData}else{const a=T.exec(e);if(!a)throw new Error(`Invalid JSON-pointer: ${e}`);const i=+a[1];if(s=a[2],"#"===s){if(i>=t)throw new Error(u("property/index",i));return n[t-i]}if(i>t)throw new Error(u("data",i));if(o=r[t-i],!s)return o}let a=o;const l=s.split("/");for(const e of l)e&&(o=i._`${o}${(0,i.getProperty)((0,d.unescapeJsonPointer)(e))}`,a=i._`${a} && ${o}`);return a;function u(e,r){return`Cannot access ${e} ${r} levels up, current level is ${t}`}}return E.getData=j,E}var we,_e={};function ke(){if(we)return _e;we=1,Object.defineProperty(_e,"__esModule",{value:!0});class e extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}}return _e.default=e,_e}var Se,Ee={};function Ie(){if(Se)return Ee;Se=1,Object.defineProperty(Ee,"__esModule",{value:!0});const e=be();class t extends Error{constructor(t,r,n,s){super(s||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,e.resolveUrl)(t,r,n),this.missingSchema=(0,e.normalizeId)((0,e.getFullPath)(t,this.missingRef))}}return Ee.default=t,Ee}var xe,Ne={};function Pe(){if(xe)return Ne;xe=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.resolveSchema=Ne.getCompilingSchema=Ne.resolveRef=Ne.compileSchema=Ne.SchemaEnv=void 0;const e=A(),t=ke(),r=V(),n=be(),s=D(),o=$e();class a{constructor(e){var t;let r;this.refs={},this.dynamicAnchors={},"object"==typeof e.schema&&(r=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=null!==(t=e.baseId)&&void 0!==t?t:(0,n.normalizeId)(null==r?void 0:r[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=null==r?void 0:r.$async,this.refs={}}}function i(s){const a=l.call(this,s);if(a)return a;const i=(0,n.getFullPath)(this.opts.uriResolver,s.root.baseId),{es5:c,lines:d}=this.opts.code,{ownProperties:u}=this.opts,p=new e.CodeGen(this.scope,{es5:c,lines:d,ownProperties:u});let h;s.$async&&(h=p.scopeValue("Error",{ref:t.default,code:e._`require("ajv/dist/runtime/validation_error").default`}));const m=p.scopeName("validate");s.validateName=m;const f={gen:p,allErrors:this.opts.allErrors,data:r.default.data,parentData:r.default.parentData,parentDataProperty:r.default.parentDataProperty,dataNames:[r.default.data],dataPathArr:[e.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:p.scopeValue("schema",!0===this.opts.code.source?{ref:s.schema,code:(0,e.stringify)(s.schema)}:{ref:s.schema}),validateName:m,ValidationError:h,schema:s.schema,schemaEnv:s,rootId:i,baseId:s.baseId||i,schemaPath:e.nil,errSchemaPath:s.schemaPath||(this.opts.jtd?"":"#"),errorPath:e._`""`,opts:this.opts,self:this};let g;try{this._compilations.add(s),(0,o.validateFunctionCode)(f),p.optimize(this.opts.code.optimize);const t=p.toString();g=`${p.scopeRefs(r.default.scope)}return ${t}`,this.opts.code.process&&(g=this.opts.code.process(g,s));const n=new Function(`${r.default.self}`,`${r.default.scope}`,g)(this,this.scope.get());if(this.scope.value(m,{ref:n}),n.errors=null,n.schema=s.schema,n.schemaEnv=s,s.$async&&(n.$async=!0),!0===this.opts.code.source&&(n.source={validateName:m,validateCode:t,scopeValues:p._values}),this.opts.unevaluated){const{props:t,items:r}=f;n.evaluated={props:t instanceof e.Name?void 0:t,items:r instanceof e.Name?void 0:r,dynamicProps:t instanceof e.Name,dynamicItems:r instanceof e.Name},n.source&&(n.source.evaluated=(0,e.stringify)(n.evaluated))}return s.validate=n,s}catch(e){throw delete s.validate,delete s.validateName,g&&this.logger.error("Error compiling schema, function code:",g),e}finally{this._compilations.delete(s)}}function c(e){return(0,n.inlineRef)(e.schema,this.opts.inlineRefs)?e.schema:e.validate?e:i.call(this,e)}function l(e){for(const t of this._compilations)if(d(t,e))return t}function d(e,t){return e.schema===t.schema&&e.root===t.root&&e.baseId===t.baseId}function u(e,t){let r;for(;"string"==typeof(r=this.refs[t]);)t=r;return r||this.schemas[t]||p.call(this,e,t)}function p(e,t){const r=this.opts.uriResolver.parse(t),s=(0,n._getFullPath)(this.opts.uriResolver,r);let o=(0,n.getFullPath)(this.opts.uriResolver,e.baseId,void 0);if(Object.keys(e.schema).length>0&&s===o)return m.call(this,r,e);const c=(0,n.normalizeId)(s),l=this.refs[c]||this.schemas[c];if("string"==typeof l){const t=p.call(this,e,l);if("object"!=typeof(null==t?void 0:t.schema))return;return m.call(this,r,t)}if("object"==typeof(null==l?void 0:l.schema)){if(l.validate||i.call(this,l),c===(0,n.normalizeId)(t)){const{schema:t}=l,{schemaId:r}=this.opts,s=t[r];return s&&(o=(0,n.resolveUrl)(this.opts.uriResolver,o,s)),new a({schema:t,schemaId:r,root:e,baseId:o})}return m.call(this,r,l)}}Ne.SchemaEnv=a,Ne.compileSchema=i,Ne.resolveRef=function(e,t,r){var s;r=(0,n.resolveUrl)(this.opts.uriResolver,t,r);const o=e.refs[r];if(o)return o;let i=u.call(this,e,r);if(void 0===i){const n=null===(s=e.localRefs)||void 0===s?void 0:s[r],{schemaId:o}=this.opts;n&&(i=new a({schema:n,schemaId:o,root:e,baseId:t}))}return void 0!==i?e.refs[r]=c.call(this,i):void 0},Ne.getCompilingSchema=l,Ne.resolveSchema=p;const h=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function m(e,{baseId:t,schema:r,root:o}){var i;if("/"!==(null===(i=e.fragment)||void 0===i?void 0:i[0]))return;for(const o of e.fragment.slice(1).split("/")){if("boolean"==typeof r)return;const e=r[(0,s.unescapeFragment)(o)];if(void 0===e)return;const a="object"==typeof(r=e)&&r[this.opts.schemaId];!h.has(o)&&a&&(t=(0,n.resolveUrl)(this.opts.uriResolver,t,a))}let c;if("boolean"!=typeof r&&r.$ref&&!(0,s.schemaHasRulesButRef)(r,this.RULES)){const e=(0,n.resolveUrl)(this.opts.uriResolver,t,r.$ref);c=p.call(this,o,e)}const{schemaId:l}=this.opts;return c=c||new a({schema:r,schemaId:l,root:o,baseId:t}),c.schema!==c.root.schema?c:void 0}return Ne}var Te,je,Ce,Oe,Re,Ae,Me,Ue={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1},De={},Le={exports:{}};function qe(){if(je)return Te;je=1;const e=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),t=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function r(e){let t="",r=0,n=0;for(n=0;n<e.length;n++)if(r=e[n].charCodeAt(0),48!==r){if(!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";t+=e[n];break}for(n+=1;n<e.length;n++){if(r=e[n].charCodeAt(0),!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";t+=e[n]}return t}const n=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function s(e){return e.length=0,!0}function o(e,t,n){if(e.length){const s=r(e);if(""===s)return n.error=!0,!1;t.push(s),e.length=0}return!0}function a(e){if(function(e,t){let r=0;for(let n=0;n<e.length;n++)e[n]===t&&r++;return r}(e,":")<2)return{host:e,isIPV6:!1};const t=function(e){let t=0;const n={error:!1,address:"",zone:""},a=[],i=[];let c=!1,l=!1,d=o;for(let r=0;r<e.length;r++){const o=e[r];if("["!==o&&"]"!==o)if(":"!==o)if("%"===o){if(!d(i,a,n))break;d=s}else i.push(o);else{if(!0===c&&(l=!0),!d(i,a,n))break;if(++t>7){n.error=!0;break}r>0&&":"===e[r-1]&&(c=!0),a.push(":")}}return i.length&&(d===s?n.zone=i.join(""):l?a.push(i.join("")):a.push(r(i))),n.address=a.join(""),n}(e);if(t.error)return{host:e,isIPV6:!1};{let e=t.address,r=t.address;return t.zone&&(e+="%"+t.zone,r+="%25"+t.zone),{host:e,isIPV6:!0,escapedHost:r}}}return Te={nonSimpleDomain:n,recomposeAuthority:function(e){const r=[];if(void 0!==e.userinfo&&(r.push(e.userinfo),r.push("@")),void 0!==e.host){let n=unescape(e.host);if(!t(n)){const t=a(n);n=!0===t.isIPV6?`[${t.escapedHost}]`:e.host}r.push(n)}return"number"!=typeof e.port&&"string"!=typeof e.port||(r.push(":"),r.push(String(e.port))),r.length?r.join(""):void 0},normalizeComponentEncoding:function(e,t){const r=!0!==t?escape:unescape;return void 0!==e.scheme&&(e.scheme=r(e.scheme)),void 0!==e.userinfo&&(e.userinfo=r(e.userinfo)),void 0!==e.host&&(e.host=r(e.host)),void 0!==e.path&&(e.path=r(e.path)),void 0!==e.query&&(e.query=r(e.query)),void 0!==e.fragment&&(e.fragment=r(e.fragment)),e},removeDotSegments:function(e){let t=e;const r=[];let n=-1,s=0;for(;s=t.length;){if(1===s){if("."===t)break;if("/"===t){r.push("/");break}r.push(t);break}if(2===s){if("."===t[0]){if("."===t[1])break;if("/"===t[1]){t=t.slice(2);continue}}else if("/"===t[0]&&("."===t[1]||"/"===t[1])){r.push("/");break}}else if(3===s&&"/.."===t){0!==r.length&&r.pop(),r.push("/");break}if("."===t[0]){if("."===t[1]){if("/"===t[2]){t=t.slice(3);continue}}else if("/"===t[1]){t=t.slice(2);continue}}else if("/"===t[0]&&"."===t[1]){if("/"===t[2]){t=t.slice(2);continue}if("."===t[2]&&"/"===t[3]){t=t.slice(3),0!==r.length&&r.pop();continue}}if(-1===(n=t.indexOf("/",1))){r.push(t);break}r.push(t.slice(0,n)),t=t.slice(n)}return r.join("")},isIPv4:t,isUUID:e,normalizeIPv6:a,stringArrayToHexStripped:r}}function ze(){if(Re)return Le.exports;Re=1;const{normalizeIPv6:e,removeDotSegments:t,recomposeAuthority:r,normalizeComponentEncoding:n,isIPv4:s,nonSimpleDomain:o}=qe(),{SCHEMES:a,getSchemeHandler:i}=function(){if(Oe)return Ce;Oe=1;const{isUUID:e}=qe(),t=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,r=["http","https","ws","wss","urn","urn:uuid"];function n(e){return!0===e.secure||!1!==e.secure&&!!e.scheme&&!(3!==e.scheme.length||"w"!==e.scheme[0]&&"W"!==e.scheme[0]||"s"!==e.scheme[1]&&"S"!==e.scheme[1]||"s"!==e.scheme[2]&&"S"!==e.scheme[2])}function s(e){return e.host||(e.error=e.error||"HTTP URIs must have a host."),e}function o(e){const t="https"===String(e.scheme).toLowerCase();return e.port!==(t?443:80)&&""!==e.port||(e.port=void 0),e.path||(e.path="/"),e}const a={scheme:"http",domainHost:!0,parse:s,serialize:o},i={scheme:"ws",domainHost:!0,parse:function(e){return e.secure=n(e),e.resourceName=(e.path||"/")+(e.query?"?"+e.query:""),e.path=void 0,e.query=void 0,e},serialize:function(e){if(e.port!==(n(e)?443:80)&&""!==e.port||(e.port=void 0),"boolean"==typeof e.secure&&(e.scheme=e.secure?"wss":"ws",e.secure=void 0),e.resourceName){const[t,r]=e.resourceName.split("?");e.path=t&&"/"!==t?t:void 0,e.query=r,e.resourceName=void 0}return e.fragment=void 0,e}},c={http:a,https:{scheme:"https",domainHost:a.domainHost,parse:s,serialize:o},ws:i,wss:{scheme:"wss",domainHost:i.domainHost,parse:i.parse,serialize:i.serialize},urn:{scheme:"urn",parse:function(e,r){if(!e.path)return e.error="URN can not be parsed",e;const n=e.path.match(t);if(n){const t=r.scheme||e.scheme||"urn";e.nid=n[1].toLowerCase(),e.nss=n[2];const s=l(`${t}:${r.nid||e.nid}`);e.path=void 0,s&&(e=s.parse(e,r))}else e.error=e.error||"URN can not be parsed.";return e},serialize:function(e,t){if(void 0===e.nid)throw new Error("URN without nid cannot be serialized");const r=t.scheme||e.scheme||"urn",n=e.nid.toLowerCase(),s=l(`${r}:${t.nid||n}`);s&&(e=s.serialize(e,t));const o=e,a=e.nss;return o.path=`${n||t.nid}:${a}`,t.skipEscape=!0,o},skipNormalize:!0},"urn:uuid":{scheme:"urn:uuid",parse:function(t,r){const n=t;return n.uuid=n.nss,n.nss=void 0,r.tolerant||n.uuid&&e(n.uuid)||(n.error=n.error||"UUID is not valid."),n},serialize:function(e){const t=e;return t.nss=(e.uuid||"").toLowerCase(),t},skipNormalize:!0}};function l(e){return e&&(c[e]||c[e.toLowerCase()])||void 0}return Object.setPrototypeOf(c,null),Ce={wsIsSecure:n,SCHEMES:c,isValidSchemeName:function(e){return-1!==r.indexOf(e)},getSchemeHandler:l}}();function c(e,r,n,s){const o={};return s||(e=u(l(e,n),n),r=u(l(r,n),n)),!(n=n||{}).tolerant&&r.scheme?(o.scheme=r.scheme,o.userinfo=r.userinfo,o.host=r.host,o.port=r.port,o.path=t(r.path||""),o.query=r.query):(void 0!==r.userinfo||void 0!==r.host||void 0!==r.port?(o.userinfo=r.userinfo,o.host=r.host,o.port=r.port,o.path=t(r.path||""),o.query=r.query):(r.path?("/"===r.path[0]?o.path=t(r.path):(void 0===e.userinfo&&void 0===e.host&&void 0===e.port||e.path?e.path?o.path=e.path.slice(0,e.path.lastIndexOf("/")+1)+r.path:o.path=r.path:o.path="/"+r.path,o.path=t(o.path)),o.query=r.query):(o.path=e.path,void 0!==r.query?o.query=r.query:o.query=e.query),o.userinfo=e.userinfo,o.host=e.host,o.port=e.port),o.scheme=e.scheme),o.fragment=r.fragment,o}function l(e,n){const s={host:e.host,scheme:e.scheme,userinfo:e.userinfo,port:e.port,path:e.path,query:e.query,nid:e.nid,nss:e.nss,uuid:e.uuid,fragment:e.fragment,reference:e.reference,resourceName:e.resourceName,secure:e.secure,error:""},o=Object.assign({},n),a=[],c=i(o.scheme||s.scheme);c&&c.serialize&&c.serialize(s,o),void 0!==s.path&&(o.skipEscape?s.path=unescape(s.path):(s.path=escape(s.path),void 0!==s.scheme&&(s.path=s.path.split("%3A").join(":")))),"suffix"!==o.reference&&s.scheme&&a.push(s.scheme,":");const l=r(s);if(void 0!==l&&("suffix"!==o.reference&&a.push("//"),a.push(l),s.path&&"/"!==s.path[0]&&a.push("/")),void 0!==s.path){let e=s.path;o.absolutePath||c&&c.absolutePath||(e=t(e)),void 0===l&&"/"===e[0]&&"/"===e[1]&&(e="/%2F"+e.slice(2)),a.push(e)}return void 0!==s.query&&a.push("?",s.query),void 0!==s.fragment&&a.push("#",s.fragment),a.join("")}const d=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function u(t,r){const n=Object.assign({},r),a={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0};let c=!1;"suffix"===n.reference&&(t=n.scheme?n.scheme+":"+t:"//"+t);const l=t.match(d);if(l){if(a.scheme=l[1],a.userinfo=l[3],a.host=l[4],a.port=parseInt(l[5],10),a.path=l[6]||"",a.query=l[7],a.fragment=l[8],isNaN(a.port)&&(a.port=l[5]),a.host){if(!1===s(a.host)){const t=e(a.host);a.host=t.host.toLowerCase(),c=t.isIPV6}else c=!0}void 0!==a.scheme||void 0!==a.userinfo||void 0!==a.host||void 0!==a.port||void 0!==a.query||a.path?void 0===a.scheme?a.reference="relative":void 0===a.fragment?a.reference="absolute":a.reference="uri":a.reference="same-document",n.reference&&"suffix"!==n.reference&&n.reference!==a.reference&&(a.error=a.error||"URI is not a "+n.reference+" reference.");const r=i(n.scheme||a.scheme);if(!(n.unicodeSupport||r&&r.unicodeSupport)&&a.host&&(n.domainHost||r&&r.domainHost)&&!1===c&&o(a.host))try{a.host=URL.domainToASCII(a.host.toLowerCase())}catch(e){a.error=a.error||"Host's domain name can not be converted to ASCII: "+e}(!r||r&&!r.skipNormalize)&&(-1!==t.indexOf("%")&&(void 0!==a.scheme&&(a.scheme=unescape(a.scheme)),void 0!==a.host&&(a.host=unescape(a.host))),a.path&&(a.path=escape(unescape(a.path))),a.fragment&&(a.fragment=encodeURI(decodeURIComponent(a.fragment)))),r&&r.parse&&r.parse(a,n)}else a.error=a.error||"URI can not be parsed.";return a}const p={SCHEMES:a,normalize:function(e,t){return"string"==typeof e?e=l(u(e,t),t):"object"==typeof e&&(e=u(l(e,t),t)),e},resolve:function(e,t,r){const n=r?Object.assign({scheme:"null"},r):{scheme:"null"},s=c(u(e,n),u(t,n),n,!0);return n.skipEscape=!0,l(s,n)},resolveComponent:c,equal:function(e,t,r){return"string"==typeof e?(e=unescape(e),e=l(n(u(e,r),!0),{...r,skipEscape:!0})):"object"==typeof e&&(e=l(n(e,!0),{...r,skipEscape:!0})),"string"==typeof t?(t=unescape(t),t=l(n(u(t,r),!0),{...r,skipEscape:!0})):"object"==typeof t&&(t=l(n(t,!0),{...r,skipEscape:!0})),e.toLowerCase()===t.toLowerCase()},serialize:l,parse:u};return Le.exports=p,Le.exports.default=p,Le.exports.fastUri=p,Le.exports}function Fe(){return Me||(Me=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;var t=$e();Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return t.KeywordCxt}});var r=A();Object.defineProperty(e,"_",{enumerable:!0,get:function(){return r._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return r.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return r.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return r.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return r.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return r.CodeGen}});const n=ke(),s=Ie(),o=G(),a=Pe(),i=A(),c=be(),l=Z(),d=D(),u=Ue,p=function(){if(Ae)return De;Ae=1,Object.defineProperty(De,"__esModule",{value:!0});const e=ze();return e.code='require("ajv/dist/runtime/uri").default',De.default=e,De}(),h=(e,t)=>new RegExp(e,t);h.code="new RegExp";const m=["removeAdditional","useDefaults","coerceTypes"],f=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),g={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},y={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'};function v(e){var t,r,n,s,o,a,i,c,l,d,u,m,f,g,y,v,b,$,w,_,k,S,E,I,x;const N=e.strict,P=null===(t=e.code)||void 0===t?void 0:t.optimize,T=!0===P||void 0===P?1:P||0,j=null!==(n=null===(r=e.code)||void 0===r?void 0:r.regExp)&&void 0!==n?n:h,C=null!==(s=e.uriResolver)&&void 0!==s?s:p.default;return{strictSchema:null===(a=null!==(o=e.strictSchema)&&void 0!==o?o:N)||void 0===a||a,strictNumbers:null===(c=null!==(i=e.strictNumbers)&&void 0!==i?i:N)||void 0===c||c,strictTypes:null!==(d=null!==(l=e.strictTypes)&&void 0!==l?l:N)&&void 0!==d?d:"log",strictTuples:null!==(m=null!==(u=e.strictTuples)&&void 0!==u?u:N)&&void 0!==m?m:"log",strictRequired:null!==(g=null!==(f=e.strictRequired)&&void 0!==f?f:N)&&void 0!==g&&g,code:e.code?{...e.code,optimize:T,regExp:j}:{optimize:T,regExp:j},loopRequired:null!==(y=e.loopRequired)&&void 0!==y?y:200,loopEnum:null!==(v=e.loopEnum)&&void 0!==v?v:200,meta:null===(b=e.meta)||void 0===b||b,messages:null===($=e.messages)||void 0===$||$,inlineRefs:null===(w=e.inlineRefs)||void 0===w||w,schemaId:null!==(_=e.schemaId)&&void 0!==_?_:"$id",addUsedSchema:null===(k=e.addUsedSchema)||void 0===k||k,validateSchema:null===(S=e.validateSchema)||void 0===S||S,validateFormats:null===(E=e.validateFormats)||void 0===E||E,unicodeRegExp:null===(I=e.unicodeRegExp)||void 0===I||I,int32range:null===(x=e.int32range)||void 0===x||x,uriResolver:C}}class b{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...v(e)};const{es5:t,lines:r}=this.opts.code;this.scope=new i.ValueScope({scope:{},prefixes:f,es5:t,lines:r}),this.logger=function(e){if(!1===e)return I;if(void 0===e)return console;if(e.log&&e.warn&&e.error)return e;throw new Error("logger must implement log, warn and error methods")}(e.logger);const n=e.validateFormats;e.validateFormats=!1,this.RULES=(0,o.getRules)(),$.call(this,g,e,"NOT SUPPORTED"),$.call(this,y,e,"DEPRECATED","warn"),this._metaOpts=E.call(this),e.formats&&k.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&S.call(this,e.keywords),"object"==typeof e.meta&&this.addMetaSchema(e.meta),_.call(this),e.validateFormats=n}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:e,meta:t,schemaId:r}=this.opts;let n=u;"id"===r&&(n={...u},n.id=n.$id,delete n.$id),t&&e&&this.addMetaSchema(n,n[r],!1)}defaultMeta(){const{meta:e,schemaId:t}=this.opts;return this.opts.defaultMeta="object"==typeof e?e[t]||e:void 0}validate(e,t){let r;if("string"==typeof e){if(r=this.getSchema(e),!r)throw new Error(`no schema with key or ref "${e}"`)}else r=this.compile(e);const n=r(t);return"$async"in r||(this.errors=r.errors),n}compile(e,t){const r=this._addSchema(e,t);return r.validate||this._compileSchemaEnv(r)}compileAsync(e,t){if("function"!=typeof this.opts.loadSchema)throw new Error("options.loadSchema should be a function");const{loadSchema:r}=this.opts;return n.call(this,e,t);async function n(e,t){await o.call(this,e.$schema);const r=this._addSchema(e,t);return r.validate||a.call(this,r)}async function o(e){e&&!this.getSchema(e)&&await n.call(this,{$ref:e},!0)}async function a(e){try{return this._compileSchemaEnv(e)}catch(t){if(!(t instanceof s.default))throw t;return i.call(this,t),await c.call(this,t.missingSchema),a.call(this,e)}}function i({missingSchema:e,missingRef:t}){if(this.refs[e])throw new Error(`AnySchema ${e} is loaded but ${t} cannot be resolved`)}async function c(e){const r=await l.call(this,e);this.refs[e]||await o.call(this,r.$schema),this.refs[e]||this.addSchema(r,e,t)}async function l(e){const t=this._loading[e];if(t)return t;try{return await(this._loading[e]=r(e))}finally{delete this._loading[e]}}}addSchema(e,t,r,n=this.opts.validateSchema){if(Array.isArray(e)){for(const t of e)this.addSchema(t,void 0,r,n);return this}let s;if("object"==typeof e){const{schemaId:t}=this.opts;if(s=e[t],void 0!==s&&"string"!=typeof s)throw new Error(`schema ${t} must be string`)}return t=(0,c.normalizeId)(t||s),this._checkUnique(t),this.schemas[t]=this._addSchema(e,r,t,n,!0),this}addMetaSchema(e,t,r=this.opts.validateSchema){return this.addSchema(e,t,!0,r),this}validateSchema(e,t){if("boolean"==typeof e)return!0;let r;if(r=e.$schema,void 0!==r&&"string"!=typeof r)throw new Error("$schema must be a string");if(r=r||this.opts.defaultMeta||this.defaultMeta(),!r)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const n=this.validate(r,e);if(!n&&t){const e="schema is invalid: "+this.errorsText();if("log"!==this.opts.validateSchema)throw new Error(e);this.logger.error(e)}return n}getSchema(e){let t;for(;"string"==typeof(t=w.call(this,e));)e=t;if(void 0===t){const{schemaId:r}=this.opts,n=new a.SchemaEnv({schema:{},schemaId:r});if(t=a.resolveSchema.call(this,n,e),!t)return;this.refs[e]=t}return t.validate||this._compileSchemaEnv(t)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const t=w.call(this,e);return"object"==typeof t&&this._cache.delete(t.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{const t=e;this._cache.delete(t);let r=e[this.opts.schemaId];return r&&(r=(0,c.normalizeId)(r),delete this.schemas[r],delete this.refs[r]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(const t of e)this.addKeyword(t);return this}addKeyword(e,t){let r;if("string"==typeof e)r=e,"object"==typeof t&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),t.keyword=r);else{if("object"!=typeof e||void 0!==t)throw new Error("invalid addKeywords parameters");if(r=(t=e).keyword,Array.isArray(r)&&!r.length)throw new Error("addKeywords: keyword must be string or non-empty array")}if(N.call(this,r,t),!t)return(0,d.eachItem)(r,e=>P.call(this,e)),this;j.call(this,t);const n={...t,type:(0,l.getJSONTypes)(t.type),schemaType:(0,l.getJSONTypes)(t.schemaType)};return(0,d.eachItem)(r,0===n.type.length?e=>P.call(this,e,n):e=>n.type.forEach(t=>P.call(this,e,n,t))),this}getKeyword(e){const t=this.RULES.all[e];return"object"==typeof t?t.definition:!!t}removeKeyword(e){const{RULES:t}=this;delete t.keywords[e],delete t.all[e];for(const r of t.rules){const t=r.rules.findIndex(t=>t.keyword===e);t>=0&&r.rules.splice(t,1)}return this}addFormat(e,t){return"string"==typeof t&&(t=new RegExp(t)),this.formats[e]=t,this}errorsText(e=this.errors,{separator:t=", ",dataVar:r="data"}={}){return e&&0!==e.length?e.map(e=>`${r}${e.instancePath} ${e.message}`).reduce((e,r)=>e+t+r):"No errors"}$dataMetaSchema(e,t){const r=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(const n of t){const t=n.split("/").slice(1);let s=e;for(const e of t)s=s[e];for(const e in r){const t=r[e];if("object"!=typeof t)continue;const{$data:n}=t.definition,o=s[e];n&&o&&(s[e]=O(o))}}return e}_removeAllSchemas(e,t){for(const r in e){const n=e[r];t&&!t.test(r)||("string"==typeof n?delete e[r]:n&&!n.meta&&(this._cache.delete(n.schema),delete e[r]))}}_addSchema(e,t,r,n=this.opts.validateSchema,s=this.opts.addUsedSchema){let o;const{schemaId:i}=this.opts;if("object"==typeof e)o=e[i];else{if(this.opts.jtd)throw new Error("schema must be object");if("boolean"!=typeof e)throw new Error("schema must be object or boolean")}let l=this._cache.get(e);if(void 0!==l)return l;r=(0,c.normalizeId)(o||r);const d=c.getSchemaRefs.call(this,e,r);return l=new a.SchemaEnv({schema:e,schemaId:i,meta:t,baseId:r,localRefs:d}),this._cache.set(l.schema,l),s&&!r.startsWith("#")&&(r&&this._checkUnique(r),this.refs[r]=l),n&&this.validateSchema(e,!0),l}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):a.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){const t=this.opts;this.opts=this._metaOpts;try{a.compileSchema.call(this,e)}finally{this.opts=t}}}function $(e,t,r,n="error"){for(const s in e){const o=s;o in t&&this.logger[n](`${r}: option ${s}. ${e[o]}`)}}function w(e){return e=(0,c.normalizeId)(e),this.schemas[e]||this.refs[e]}function _(){const e=this.opts.schemas;if(e)if(Array.isArray(e))this.addSchema(e);else for(const t in e)this.addSchema(e[t],t)}function k(){for(const e in this.opts.formats){const t=this.opts.formats[e];t&&this.addFormat(e,t)}}function S(e){if(Array.isArray(e))this.addVocabulary(e);else{this.logger.warn("keywords option as map is deprecated, pass array");for(const t in e){const r=e[t];r.keyword||(r.keyword=t),this.addKeyword(r)}}}function E(){const e={...this.opts};for(const t of m)delete e[t];return e}b.ValidationError=n.default,b.MissingRefError=s.default,e.default=b;const I={log(){},warn(){},error(){}};const x=/^[a-z_$][a-z0-9_$:-]*$/i;function N(e,t){const{RULES:r}=this;if((0,d.eachItem)(e,e=>{if(r.keywords[e])throw new Error(`Keyword ${e} is already defined`);if(!x.test(e))throw new Error(`Keyword ${e} has invalid name`)}),t&&t.$data&&!("code"in t)&&!("validate"in t))throw new Error('$data keyword must have "code" or "validate" function')}function P(e,t,r){var n;const s=null==t?void 0:t.post;if(r&&s)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:o}=this;let a=s?o.post:o.rules.find(({type:e})=>e===r);if(a||(a={type:r,rules:[]},o.rules.push(a)),o.keywords[e]=!0,!t)return;const i={keyword:e,definition:{...t,type:(0,l.getJSONTypes)(t.type),schemaType:(0,l.getJSONTypes)(t.schemaType)}};t.before?T.call(this,a,i,t.before):a.rules.push(i),o.all[e]=i,null===(n=t.implements)||void 0===n||n.forEach(e=>this.addKeyword(e))}function T(e,t,r){const n=e.rules.findIndex(e=>e.keyword===r);n>=0?e.rules.splice(n,0,t):(e.rules.push(t),this.logger.warn(`rule ${r} is not defined`))}function j(e){let{metaSchema:t}=e;void 0!==t&&(e.$data&&this.opts.$data&&(t=O(t)),e.validateSchema=this.compile(t,!0))}const C={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function O(e){return{anyOf:[e,C]}}}(S)),S}var Ve,Be={},He={},Ke={};var Je,Ge,We={};function Ye(){if(Ge)return He;Ge=1,Object.defineProperty(He,"__esModule",{value:!0});const e=function(){if(Ve)return Ke;Ve=1,Object.defineProperty(Ke,"__esModule",{value:!0});const e={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};return Ke.default=e,Ke}(),t=function(){if(Je)return We;Je=1,Object.defineProperty(We,"__esModule",{value:!0}),We.callRef=We.getValidate=void 0;const e=Ie(),t=ae(),r=A(),n=V(),s=Pe(),o=D(),a={keyword:"$ref",schemaType:"string",code(t){const{gen:n,schema:o,it:a}=t,{baseId:l,schemaEnv:d,validateName:u,opts:p,self:h}=a,{root:m}=d;if(("#"===o||"#/"===o)&&l===m.baseId)return function(){if(d===m)return c(t,u,d,d.$async);const e=n.scopeValue("root",{ref:m});return c(t,r._`${e}.validate`,m,m.$async)}();const f=s.resolveRef.call(h,m,l,o);if(void 0===f)throw new e.default(a.opts.uriResolver,l,o);return f instanceof s.SchemaEnv?function(e){const r=i(t,e);c(t,r,e,e.$async)}(f):function(e){const s=n.scopeValue("schema",!0===p.code.source?{ref:e,code:(0,r.stringify)(e)}:{ref:e}),a=n.name("valid"),i=t.subschema({schema:e,dataTypes:[],schemaPath:r.nil,topSchemaRef:s,errSchemaPath:o},a);t.mergeEvaluated(i),t.ok(a)}(f)}};function i(e,t){const{gen:n}=e;return t.validate?n.scopeValue("validate",{ref:t.validate}):r._`${n.scopeValue("wrapper",{ref:t})}.validate`}function c(e,s,a,i){const{gen:c,it:l}=e,{allErrors:d,schemaEnv:u,opts:p}=l,h=p.passContext?n.default.this:r.nil;function m(e){const t=r._`${e}.errors`;c.assign(n.default.vErrors,r._`${n.default.vErrors} === null ? ${t} : ${n.default.vErrors}.concat(${t})`),c.assign(n.default.errors,r._`${n.default.vErrors}.length`)}function f(e){var t;if(!l.opts.unevaluated)return;const n=null===(t=null==a?void 0:a.validate)||void 0===t?void 0:t.evaluated;if(!0!==l.props)if(n&&!n.dynamicProps)void 0!==n.props&&(l.props=o.mergeEvaluated.props(c,n.props,l.props));else{const t=c.var("props",r._`${e}.evaluated.props`);l.props=o.mergeEvaluated.props(c,t,l.props,r.Name)}if(!0!==l.items)if(n&&!n.dynamicItems)void 0!==n.items&&(l.items=o.mergeEvaluated.items(c,n.items,l.items));else{const t=c.var("items",r._`${e}.evaluated.items`);l.items=o.mergeEvaluated.items(c,t,l.items,r.Name)}}i?function(){if(!u.$async)throw new Error("async schema referenced by sync schema");const n=c.let("valid");c.try(()=>{c.code(r._`await ${(0,t.callValidateCode)(e,s,h)}`),f(s),d||c.assign(n,!0)},e=>{c.if(r._`!(${e} instanceof ${l.ValidationError})`,()=>c.throw(e)),m(e),d||c.assign(n,!1)}),e.ok(n)}():e.result((0,t.callValidateCode)(e,s,h),()=>f(s),()=>m(s))}return We.getValidate=i,We.callRef=c,We.default=a,We}(),r=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",e.default,t.default];return He.default=r,He}var Xe,Qe={},Ze={};var et,tt={};var rt,nt,st={},ot={};function at(){if(nt)return st;nt=1,Object.defineProperty(st,"__esModule",{value:!0});const e=A(),t=D(),r=function(){if(rt)return ot;function e(e){const t=e.length;let r,n=0,s=0;for(;s<t;)n++,r=e.charCodeAt(s++),r>=55296&&r<=56319&&s<t&&(r=e.charCodeAt(s),56320==(64512&r)&&s++);return n}return rt=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.default=e,e.code='require("ajv/dist/runtime/ucs2length").default',ot}(),n={message({keyword:t,schemaCode:r}){const n="maxLength"===t?"more":"fewer";return e.str`must NOT have ${n} than ${r} characters`},params:({schemaCode:t})=>e._`{limit: ${t}}`},s={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:n,code(n){const{keyword:s,data:o,schemaCode:a,it:i}=n,c="maxLength"===s?e.operators.GT:e.operators.LT,l=!1===i.opts.unicode?e._`${o}.length`:e._`${(0,t.useFunc)(n.gen,r.default)}(${o})`;n.fail$data(e._`${l} ${c} ${a}`)}};return st.default=s,st}var it,ct={};var lt,dt={};var ut,pt={};function ht(){if(ut)return pt;ut=1,Object.defineProperty(pt,"__esModule",{value:!0});const e=ae(),t=A(),r=D(),n={keyword:"required",type:"object",schemaType:"array",$data:!0,error:{message:({params:{missingProperty:e}})=>t.str`must have required property '${e}'`,params:({params:{missingProperty:e}})=>t._`{missingProperty: ${e}}`},code(n){const{gen:s,schema:o,schemaCode:a,data:i,$data:c,it:l}=n,{opts:d}=l;if(!c&&0===o.length)return;const u=o.length>=d.loopRequired;if(l.allErrors?function(){if(u||c)n.block$data(t.nil,p);else for(const t of o)(0,e.checkReportMissingProp)(n,t)}():function(){const r=s.let("missing");if(u||c){const o=s.let("valid",!0);n.block$data(o,()=>function(r,o){n.setParams({missingProperty:r}),s.forOf(r,a,()=>{s.assign(o,(0,e.propertyInData)(s,i,r,d.ownProperties)),s.if((0,t.not)(o),()=>{n.error(),s.break()})},t.nil)}(r,o)),n.ok(o)}else s.if((0,e.checkMissingProp)(n,o,r)),(0,e.reportMissingProp)(n,r),s.else()}(),d.strictRequired){const e=n.parentSchema.properties,{definedProperties:t}=n.it;for(const n of o)if(void 0===(null==e?void 0:e[n])&&!t.has(n)){const e=`required property "${n}" is not defined at "${l.schemaEnv.baseId+l.errSchemaPath}" (strictRequired)`;(0,r.checkStrictMode)(l,e,l.opts.strictRequired)}}function p(){s.forOf("prop",a,t=>{n.setParams({missingProperty:t}),s.if((0,e.noPropertyInData)(s,i,t,d.ownProperties),()=>n.error())})}}};return pt.default=n,pt}var mt,ft={};var gt,yt,vt={},bt={};function $t(){if(gt)return bt;gt=1,Object.defineProperty(bt,"__esModule",{value:!0});const e=he();return e.code='require("ajv/dist/runtime/equal").default',bt.default=e,bt}function wt(){if(yt)return vt;yt=1,Object.defineProperty(vt,"__esModule",{value:!0});const e=Z(),t=A(),r=D(),n=$t(),s={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:{message:({params:{i:e,j:r}})=>t.str`must NOT have duplicate items (items ## ${r} and ${e} are identical)`,params:({params:{i:e,j:r}})=>t._`{i: ${e}, j: ${r}}`},code(s){const{gen:o,data:a,$data:i,schema:c,parentSchema:l,schemaCode:d,it:u}=s;if(!i&&!c)return;const p=o.let("valid"),h=l.items?(0,e.getSchemaTypes)(l.items):[];function m(r,n){const i=o.name("item"),c=(0,e.checkDataTypes)(h,i,u.opts.strictNumbers,e.DataType.Wrong),l=o.const("indices",t._`{}`);o.for(t._`;${r}--;`,()=>{o.let(i,t._`${a}[${r}]`),o.if(c,t._`continue`),h.length>1&&o.if(t._`typeof ${i} == "string"`,t._`${i} += "_"`),o.if(t._`typeof ${l}[${i}] == "number"`,()=>{o.assign(n,t._`${l}[${i}]`),s.error(),o.assign(p,!1).break()}).code(t._`${l}[${i}] = ${r}`)})}function f(e,i){const c=(0,r.useFunc)(o,n.default),l=o.name("outer");o.label(l).for(t._`;${e}--;`,()=>o.for(t._`${i} = ${e}; ${i}--;`,()=>o.if(t._`${c}(${a}[${e}], ${a}[${i}])`,()=>{s.error(),o.assign(p,!1).break(l)})))}s.block$data(p,function(){const e=o.let("i",t._`${a}.length`),r=o.let("j");s.setParams({i:e,j:r}),o.assign(p,!0),o.if(t._`${e} > 1`,()=>(h.length>0&&!h.some(e=>"object"===e||"array"===e)?m:f)(e,r))},t._`${d} === false`),s.ok(p)}};return vt.default=s,vt}var _t,kt={};var St,Et,It={};function xt(){if(St)return It;St=1,Object.defineProperty(It,"__esModule",{value:!0});const e=A(),t=D(),r=$t(),n={keyword:"enum",schemaType:"array",$data:!0,error:{message:"must be equal to one of the allowed values",params:({schemaCode:t})=>e._`{allowedValues: ${t}}`},code(n){const{gen:s,data:o,$data:a,schema:i,schemaCode:c,it:l}=n;if(!a&&0===i.length)throw new Error("enum must have non-empty array");const d=i.length>=l.opts.loopEnum;let u;const p=()=>null!=u?u:u=(0,t.useFunc)(s,r.default);let h;if(d||a)h=s.let("valid"),n.block$data(h,function(){s.assign(h,!1),s.forOf("v",c,t=>s.if(e._`${p()}(${o}, ${t})`,()=>s.assign(h,!0).break()))});else{if(!Array.isArray(i))throw new Error("ajv implementation error");const t=s.const("vSchema",c);h=(0,e.or)(...i.map((r,n)=>function(t,r){const n=i[r];return"object"==typeof n&&null!==n?e._`${p()}(${o}, ${t}[${r}])`:e._`${o} === ${n}`}(t,n)))}n.pass(h)}};return It.default=n,It}function Nt(){if(Et)return Qe;Et=1,Object.defineProperty(Qe,"__esModule",{value:!0});const e=function(){if(Xe)return Ze;Xe=1,Object.defineProperty(Ze,"__esModule",{value:!0});const e=A(),t=e.operators,r={maximum:{okStr:"<=",ok:t.LTE,fail:t.GT},minimum:{okStr:">=",ok:t.GTE,fail:t.LT},exclusiveMaximum:{okStr:"<",ok:t.LT,fail:t.GTE},exclusiveMinimum:{okStr:">",ok:t.GT,fail:t.LTE}},n={message:({keyword:t,schemaCode:n})=>e.str`must be ${r[t].okStr} ${n}`,params:({keyword:t,schemaCode:n})=>e._`{comparison: ${r[t].okStr}, limit: ${n}}`},s={keyword:Object.keys(r),type:"number",schemaType:"number",$data:!0,error:n,code(t){const{keyword:n,data:s,schemaCode:o}=t;t.fail$data(e._`${s} ${r[n].fail} ${o} || isNaN(${s})`)}};return Ze.default=s,Ze}(),t=function(){if(et)return tt;et=1,Object.defineProperty(tt,"__esModule",{value:!0});const e=A(),t={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:{message:({schemaCode:t})=>e.str`must be multiple of ${t}`,params:({schemaCode:t})=>e._`{multipleOf: ${t}}`},code(t){const{gen:r,data:n,schemaCode:s,it:o}=t,a=o.opts.multipleOfPrecision,i=r.let("res"),c=a?e._`Math.abs(Math.round(${i}) - ${i}) > 1e-${a}`:e._`${i} !== parseInt(${i})`;t.fail$data(e._`(${s} === 0 || (${i} = ${n}/${s}, ${c}))`)}};return tt.default=t,tt}(),r=at(),n=function(){if(it)return ct;it=1,Object.defineProperty(ct,"__esModule",{value:!0});const e=ae(),t=A(),r={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:{message:({schemaCode:e})=>t.str`must match pattern "${e}"`,params:({schemaCode:e})=>t._`{pattern: ${e}}`},code(r){const{data:n,$data:s,schema:o,schemaCode:a,it:i}=r,c=i.opts.unicodeRegExp?"u":"",l=s?t._`(new RegExp(${a}, ${c}))`:(0,e.usePattern)(r,o);r.fail$data(t._`!${l}.test(${n})`)}};return ct.default=r,ct}(),s=function(){if(lt)return dt;lt=1,Object.defineProperty(dt,"__esModule",{value:!0});const e=A(),t={message({keyword:t,schemaCode:r}){const n="maxProperties"===t?"more":"fewer";return e.str`must NOT have ${n} than ${r} properties`},params:({schemaCode:t})=>e._`{limit: ${t}}`},r={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:t,code(t){const{keyword:r,data:n,schemaCode:s}=t,o="maxProperties"===r?e.operators.GT:e.operators.LT;t.fail$data(e._`Object.keys(${n}).length ${o} ${s}`)}};return dt.default=r,dt}(),o=ht(),a=function(){if(mt)return ft;mt=1,Object.defineProperty(ft,"__esModule",{value:!0});const e=A(),t={message({keyword:t,schemaCode:r}){const n="maxItems"===t?"more":"fewer";return e.str`must NOT have ${n} than ${r} items`},params:({schemaCode:t})=>e._`{limit: ${t}}`},r={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:t,code(t){const{keyword:r,data:n,schemaCode:s}=t,o="maxItems"===r?e.operators.GT:e.operators.LT;t.fail$data(e._`${n}.length ${o} ${s}`)}};return ft.default=r,ft}(),i=wt(),c=function(){if(_t)return kt;_t=1,Object.defineProperty(kt,"__esModule",{value:!0});const e=A(),t=D(),r=$t(),n={keyword:"const",$data:!0,error:{message:"must be equal to constant",params:({schemaCode:t})=>e._`{allowedValue: ${t}}`},code(n){const{gen:s,data:o,$data:a,schemaCode:i,schema:c}=n;a||c&&"object"==typeof c?n.fail$data(e._`!${(0,t.useFunc)(s,r.default)}(${o}, ${i})`):n.fail(e._`${c} !== ${o}`)}};return kt.default=n,kt}(),l=xt(),d=[e.default,t.default,r.default,n.default,s.default,o.default,a.default,i.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},c.default,l.default];return Qe.default=d,Qe}var Pt,Tt={},jt={};function Ct(){if(Pt)return jt;Pt=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.validateAdditionalItems=void 0;const e=A(),t=D(),r={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:{message:({params:{len:t}})=>e.str`must NOT have more than ${t} items`,params:({params:{len:t}})=>e._`{limit: ${t}}`},code(e){const{parentSchema:r,it:s}=e,{items:o}=r;Array.isArray(o)?n(e,o):(0,t.checkStrictMode)(s,'"additionalItems" is ignored when "items" is not an array of schemas')}};function n(r,n){const{gen:s,schema:o,data:a,keyword:i,it:c}=r;c.items=!0;const l=s.const("len",e._`${a}.length`);if(!1===o)r.setParams({len:n.length}),r.pass(e._`${l} <= ${n.length}`);else if("object"==typeof o&&!(0,t.alwaysValidSchema)(c,o)){const o=s.var("valid",e._`${l} <= ${n.length}`);s.if((0,e.not)(o),()=>function(o){s.forRange("i",n.length,l,n=>{r.subschema({keyword:i,dataProp:n,dataPropType:t.Type.Num},o),c.allErrors||s.if((0,e.not)(o),()=>s.break())})}(o)),r.ok(o)}}return jt.validateAdditionalItems=n,jt.default=r,jt}var Ot,Rt,At={},Mt={};function Ut(){if(Ot)return Mt;Ot=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.validateTuple=void 0;const e=A(),t=D(),r=ae(),n={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(e){const{schema:n,it:o}=e;if(Array.isArray(n))return s(e,"additionalItems",n);o.items=!0,(0,t.alwaysValidSchema)(o,n)||e.ok((0,r.validateArray)(e))}};function s(r,n,s=r.schema){const{gen:o,parentSchema:a,data:i,keyword:c,it:l}=r;!function(e){const{opts:r,errSchemaPath:o}=l,a=s.length,i=a===e.minItems&&(a===e.maxItems||!1===e[n]);if(r.strictTuples&&!i){const e=`"${c}" is ${a}-tuple, but minItems or maxItems/${n} are not specified or different at path "${o}"`;(0,t.checkStrictMode)(l,e,r.strictTuples)}}(a),l.opts.unevaluated&&s.length&&!0!==l.items&&(l.items=t.mergeEvaluated.items(o,s.length,l.items));const d=o.name("valid"),u=o.const("len",e._`${i}.length`);s.forEach((n,s)=>{(0,t.alwaysValidSchema)(l,n)||(o.if(e._`${u} > ${s}`,()=>r.subschema({keyword:c,schemaProp:s,dataProp:s},d)),r.ok(d))})}return Mt.validateTuple=s,Mt.default=n,Mt}var Dt,Lt={};var qt,zt={};function Ft(){if(qt)return zt;qt=1,Object.defineProperty(zt,"__esModule",{value:!0});const e=A(),t=D(),r={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:{message:({params:{min:t,max:r}})=>void 0===r?e.str`must contain at least ${t} valid item(s)`:e.str`must contain at least ${t} and no more than ${r} valid item(s)`,params:({params:{min:t,max:r}})=>void 0===r?e._`{minContains: ${t}}`:e._`{minContains: ${t}, maxContains: ${r}}`},code(r){const{gen:n,schema:s,parentSchema:o,data:a,it:i}=r;let c,l;const{minContains:d,maxContains:u}=o;i.opts.next?(c=void 0===d?1:d,l=u):c=1;const p=n.const("len",e._`${a}.length`);if(r.setParams({min:c,max:l}),void 0===l&&0===c)return void(0,t.checkStrictMode)(i,'"minContains" == 0 without "maxContains": "contains" keyword ignored');if(void 0!==l&&c>l)return(0,t.checkStrictMode)(i,'"minContains" > "maxContains" is always invalid'),void r.fail();if((0,t.alwaysValidSchema)(i,s)){let t=e._`${p} >= ${c}`;return void 0!==l&&(t=e._`${t} && ${p} <= ${l}`),void r.pass(t)}i.items=!0;const h=n.name("valid");function m(){const t=n.name("_valid"),r=n.let("count",0);f(t,()=>n.if(t,()=>function(t){n.code(e._`${t}++`),void 0===l?n.if(e._`${t} >= ${c}`,()=>n.assign(h,!0).break()):(n.if(e._`${t} > ${l}`,()=>n.assign(h,!1).break()),1===c?n.assign(h,!0):n.if(e._`${t} >= ${c}`,()=>n.assign(h,!0)))}(r)))}function f(e,s){n.forRange("i",0,p,n=>{r.subschema({keyword:"contains",dataProp:n,dataPropType:t.Type.Num,compositeRule:!0},e),s()})}void 0===l&&1===c?f(h,()=>n.if(h,()=>n.break())):0===c?(n.let(h,!0),void 0!==l&&n.if(e._`${a}.length > 0`,m)):(n.let(h,!1),m()),r.result(h,()=>r.reset())}};return zt.default=r,zt}var Vt,Bt={};function Ht(){return Vt||(Vt=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validateSchemaDeps=e.validatePropertyDeps=e.error=void 0;const t=A(),r=D(),n=ae();e.error={message:({params:{property:e,depsCount:r,deps:n}})=>{const s=1===r?"property":"properties";return t.str`must have ${s} ${n} when property ${e} is present`},params:({params:{property:e,depsCount:r,deps:n,missingProperty:s}})=>t._`{property: ${e},
    missingProperty: ${s},
    depsCount: ${r},
    deps: ${n}}`};const s={keyword:"dependencies",type:"object",schemaType:"object",error:e.error,code(e){const[t,r]=function({schema:e}){const t={},r={};for(const n in e){if("__proto__"===n)continue;(Array.isArray(e[n])?t:r)[n]=e[n]}return[t,r]}(e);o(e,t),a(e,r)}};function o(e,r=e.schema){const{gen:s,data:o,it:a}=e;if(0===Object.keys(r).length)return;const i=s.let("missing");for(const c in r){const l=r[c];if(0===l.length)continue;const d=(0,n.propertyInData)(s,o,c,a.opts.ownProperties);e.setParams({property:c,depsCount:l.length,deps:l.join(", ")}),a.allErrors?s.if(d,()=>{for(const t of l)(0,n.checkReportMissingProp)(e,t)}):(s.if(t._`${d} && (${(0,n.checkMissingProp)(e,l,i)})`),(0,n.reportMissingProp)(e,i),s.else())}}function a(e,t=e.schema){const{gen:s,data:o,keyword:a,it:i}=e,c=s.name("valid");for(const l in t)(0,r.alwaysValidSchema)(i,t[l])||(s.if((0,n.propertyInData)(s,o,l,i.opts.ownProperties),()=>{const t=e.subschema({keyword:a,schemaProp:l},c);e.mergeValidEvaluated(t,c)},()=>s.var(c,!0)),e.ok(c))}e.validatePropertyDeps=o,e.validateSchemaDeps=a,e.default=s}(Bt)),Bt}var Kt,Jt={};var Gt,Wt={};function Yt(){if(Gt)return Wt;Gt=1,Object.defineProperty(Wt,"__esModule",{value:!0});const e=ae(),t=A(),r=V(),n=D(),s={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:{message:"must NOT have additional properties",params:({params:e})=>t._`{additionalProperty: ${e.additionalProperty}}`},code(s){const{gen:o,schema:a,parentSchema:i,data:c,errsCount:l,it:d}=s;if(!l)throw new Error("ajv implementation error");const{allErrors:u,opts:p}=d;if(d.props=!0,"all"!==p.removeAdditional&&(0,n.alwaysValidSchema)(d,a))return;const h=(0,e.allSchemaProperties)(i.properties),m=(0,e.allSchemaProperties)(i.patternProperties);function f(e){o.code(t._`delete ${c}[${e}]`)}function g(e){if("all"===p.removeAdditional||p.removeAdditional&&!1===a)f(e);else{if(!1===a)return s.setParams({additionalProperty:e}),s.error(),void(u||o.break());if("object"==typeof a&&!(0,n.alwaysValidSchema)(d,a)){const r=o.name("valid");"failing"===p.removeAdditional?(y(e,r,!1),o.if((0,t.not)(r),()=>{s.reset(),f(e)})):(y(e,r),u||o.if((0,t.not)(r),()=>o.break()))}}}function y(e,t,r){const o={keyword:"additionalProperties",dataProp:e,dataPropType:n.Type.Str};!1===r&&Object.assign(o,{compositeRule:!0,createErrors:!1,allErrors:!1}),s.subschema(o,t)}o.forIn("key",c,r=>{h.length||m.length?o.if(function(r){let a;if(h.length>8){const t=(0,n.schemaRefOrVal)(d,i.properties,"properties");a=(0,e.isOwnProperty)(o,t,r)}else a=h.length?(0,t.or)(...h.map(e=>t._`${r} === ${e}`)):t.nil;return m.length&&(a=(0,t.or)(a,...m.map(n=>t._`${(0,e.usePattern)(s,n)}.test(${r})`))),(0,t.not)(a)}(r),()=>g(r)):g(r)}),s.ok(t._`${l} === ${r.default.errors}`)}};return Wt.default=s,Wt}var Xt,Qt={};var Zt,er={};var tr,rr={};var nr,sr={};var or,ar={};var ir,cr={};var lr,dr={};var ur,pr,hr={};function mr(){if(pr)return Tt;pr=1,Object.defineProperty(Tt,"__esModule",{value:!0});const e=Ct(),t=function(){if(Rt)return At;Rt=1,Object.defineProperty(At,"__esModule",{value:!0});const e=Ut(),t={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,e.validateTuple)(t,"items")};return At.default=t,At}(),r=Ut(),n=function(){if(Dt)return Lt;Dt=1,Object.defineProperty(Lt,"__esModule",{value:!0});const e=A(),t=D(),r=ae(),n=Ct(),s={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:{message:({params:{len:t}})=>e.str`must NOT have more than ${t} items`,params:({params:{len:t}})=>e._`{limit: ${t}}`},code(e){const{schema:s,parentSchema:o,it:a}=e,{prefixItems:i}=o;a.items=!0,(0,t.alwaysValidSchema)(a,s)||(i?(0,n.validateAdditionalItems)(e,i):e.ok((0,r.validateArray)(e)))}};return Lt.default=s,Lt}(),s=Ft(),o=Ht(),a=function(){if(Kt)return Jt;Kt=1,Object.defineProperty(Jt,"__esModule",{value:!0});const e=A(),t=D(),r={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:{message:"property name must be valid",params:({params:t})=>e._`{propertyName: ${t.propertyName}}`},code(r){const{gen:n,schema:s,data:o,it:a}=r;if((0,t.alwaysValidSchema)(a,s))return;const i=n.name("valid");n.forIn("key",o,t=>{r.setParams({propertyName:t}),r.subschema({keyword:"propertyNames",data:t,dataTypes:["string"],propertyName:t,compositeRule:!0},i),n.if((0,e.not)(i),()=>{r.error(!0),a.allErrors||n.break()})}),r.ok(i)}};return Jt.default=r,Jt}(),i=Yt(),c=function(){if(Xt)return Qt;Xt=1,Object.defineProperty(Qt,"__esModule",{value:!0});const e=$e(),t=ae(),r=D(),n=Yt(),s={keyword:"properties",type:"object",schemaType:"object",code(s){const{gen:o,schema:a,parentSchema:i,data:c,it:l}=s;"all"===l.opts.removeAdditional&&void 0===i.additionalProperties&&n.default.code(new e.KeywordCxt(l,n.default,"additionalProperties"));const d=(0,t.allSchemaProperties)(a);for(const e of d)l.definedProperties.add(e);l.opts.unevaluated&&d.length&&!0!==l.props&&(l.props=r.mergeEvaluated.props(o,(0,r.toHash)(d),l.props));const u=d.filter(e=>!(0,r.alwaysValidSchema)(l,a[e]));if(0===u.length)return;const p=o.name("valid");for(const e of u)h(e)?m(e):(o.if((0,t.propertyInData)(o,c,e,l.opts.ownProperties)),m(e),l.allErrors||o.else().var(p,!0),o.endIf()),s.it.definedProperties.add(e),s.ok(p);function h(e){return l.opts.useDefaults&&!l.compositeRule&&void 0!==a[e].default}function m(e){s.subschema({keyword:"properties",schemaProp:e,dataProp:e},p)}}};return Qt.default=s,Qt}(),l=function(){if(Zt)return er;Zt=1,Object.defineProperty(er,"__esModule",{value:!0});const e=ae(),t=A(),r=D(),n=D(),s={keyword:"patternProperties",type:"object",schemaType:"object",code(s){const{gen:o,schema:a,data:i,parentSchema:c,it:l}=s,{opts:d}=l,u=(0,e.allSchemaProperties)(a),p=u.filter(e=>(0,r.alwaysValidSchema)(l,a[e]));if(0===u.length||p.length===u.length&&(!l.opts.unevaluated||!0===l.props))return;const h=d.strictSchema&&!d.allowMatchingProperties&&c.properties,m=o.name("valid");!0===l.props||l.props instanceof t.Name||(l.props=(0,n.evaluatedPropsToName)(o,l.props));const{props:f}=l;function g(e){for(const t in h)new RegExp(e).test(t)&&(0,r.checkStrictMode)(l,`property ${t} matches pattern ${e} (use allowMatchingProperties)`)}function y(r){o.forIn("key",i,a=>{o.if(t._`${(0,e.usePattern)(s,r)}.test(${a})`,()=>{const e=p.includes(r);e||s.subschema({keyword:"patternProperties",schemaProp:r,dataProp:a,dataPropType:n.Type.Str},m),l.opts.unevaluated&&!0!==f?o.assign(t._`${f}[${a}]`,!0):e||l.allErrors||o.if((0,t.not)(m),()=>o.break())})})}!function(){for(const e of u)h&&g(e),l.allErrors?y(e):(o.var(m,!0),y(e),o.if(m))}()}};return er.default=s,er}(),d=function(){if(tr)return rr;tr=1,Object.defineProperty(rr,"__esModule",{value:!0});const e=D(),t={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){const{gen:r,schema:n,it:s}=t;if((0,e.alwaysValidSchema)(s,n))return void t.fail();const o=r.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),t.failResult(o,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};return rr.default=t,rr}(),u=function(){if(nr)return sr;nr=1,Object.defineProperty(sr,"__esModule",{value:!0});const e={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:ae().validateUnion,error:{message:"must match a schema in anyOf"}};return sr.default=e,sr}(),p=function(){if(or)return ar;or=1,Object.defineProperty(ar,"__esModule",{value:!0});const e=A(),t=D(),r={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:{message:"must match exactly one schema in oneOf",params:({params:t})=>e._`{passingSchemas: ${t.passing}}`},code(r){const{gen:n,schema:s,parentSchema:o,it:a}=r;if(!Array.isArray(s))throw new Error("ajv implementation error");if(a.opts.discriminator&&o.discriminator)return;const i=s,c=n.let("valid",!1),l=n.let("passing",null),d=n.name("_valid");r.setParams({passing:l}),n.block(function(){i.forEach((s,o)=>{let i;(0,t.alwaysValidSchema)(a,s)?n.var(d,!0):i=r.subschema({keyword:"oneOf",schemaProp:o,compositeRule:!0},d),o>0&&n.if(e._`${d} && ${c}`).assign(c,!1).assign(l,e._`[${l}, ${o}]`).else(),n.if(d,()=>{n.assign(c,!0),n.assign(l,o),i&&r.mergeEvaluated(i,e.Name)})})}),r.result(c,()=>r.reset(),()=>r.error(!0))}};return ar.default=r,ar}(),h=function(){if(ir)return cr;ir=1,Object.defineProperty(cr,"__esModule",{value:!0});const e=D(),t={keyword:"allOf",schemaType:"array",code(t){const{gen:r,schema:n,it:s}=t;if(!Array.isArray(n))throw new Error("ajv implementation error");const o=r.name("valid");n.forEach((r,n)=>{if((0,e.alwaysValidSchema)(s,r))return;const a=t.subschema({keyword:"allOf",schemaProp:n},o);t.ok(o),t.mergeEvaluated(a)})}};return cr.default=t,cr}(),m=function(){if(lr)return dr;lr=1,Object.defineProperty(dr,"__esModule",{value:!0});const e=A(),t=D(),r={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:{message:({params:t})=>e.str`must match "${t.ifClause}" schema`,params:({params:t})=>e._`{failingKeyword: ${t.ifClause}}`},code(r){const{gen:s,parentSchema:o,it:a}=r;void 0===o.then&&void 0===o.else&&(0,t.checkStrictMode)(a,'"if" without "then" and "else" is ignored');const i=n(a,"then"),c=n(a,"else");if(!i&&!c)return;const l=s.let("valid",!0),d=s.name("_valid");if(function(){const e=r.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},d);r.mergeEvaluated(e)}(),r.reset(),i&&c){const e=s.let("ifClause");r.setParams({ifClause:e}),s.if(d,u("then",e),u("else",e))}else i?s.if(d,u("then")):s.if((0,e.not)(d),u("else"));function u(t,n){return()=>{const o=r.subschema({keyword:t},d);s.assign(l,d),r.mergeValidEvaluated(o,l),n?s.assign(n,e._`${t}`):r.setParams({ifClause:t})}}r.pass(l,()=>r.error(!0))}};function n(e,r){const n=e.schema[r];return void 0!==n&&!(0,t.alwaysValidSchema)(e,n)}return dr.default=r,dr}(),f=function(){if(ur)return hr;ur=1,Object.defineProperty(hr,"__esModule",{value:!0});const e=D(),t={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:r,it:n}){void 0===r.if&&(0,e.checkStrictMode)(n,`"${t}" without "if" is ignored`)}};return hr.default=t,hr}();return Tt.default=function(g=!1){const y=[d.default,u.default,p.default,h.default,m.default,f.default,a.default,i.default,o.default,c.default,l.default];return g?y.push(t.default,n.default):y.push(e.default,r.default),y.push(s.default),y},Tt}var fr,gr,yr={},vr={};function br(){if(fr)return vr;fr=1,Object.defineProperty(vr,"__esModule",{value:!0});const e=A(),t={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:{message:({schemaCode:t})=>e.str`must match format "${t}"`,params:({schemaCode:t})=>e._`{format: ${t}}`},code(t,r){const{gen:n,data:s,$data:o,schema:a,schemaCode:i,it:c}=t,{opts:l,errSchemaPath:d,schemaEnv:u,self:p}=c;l.validateFormats&&(o?function(){const o=n.scopeValue("formats",{ref:p.formats,code:l.code.formats}),a=n.const("fDef",e._`${o}[${i}]`),c=n.let("fType"),d=n.let("format");n.if(e._`typeof ${a} == "object" && !(${a} instanceof RegExp)`,()=>n.assign(c,e._`${a}.type || "string"`).assign(d,e._`${a}.validate`),()=>n.assign(c,e._`"string"`).assign(d,a)),t.fail$data((0,e.or)(!1===l.strictSchema?e.nil:e._`${i} && !${d}`,function(){const t=u.$async?e._`(${a}.async ? await ${d}(${s}) : ${d}(${s}))`:e._`${d}(${s})`,n=e._`(typeof ${d} == "function" ? ${t} : ${d}.test(${s}))`;return e._`${d} && ${d} !== true && ${c} === ${r} && !${n}`}()))}():function(){const o=p.formats[a];if(!o)return void function(){if(!1===l.strictSchema)return void p.logger.warn(e());throw new Error(e());function e(){return`unknown format "${a}" ignored in schema at path "${d}"`}}();if(!0===o)return;const[i,c,h]=function(t){const r=t instanceof RegExp?(0,e.regexpCode)(t):l.code.formats?e._`${l.code.formats}${(0,e.getProperty)(a)}`:void 0,s=n.scopeValue("formats",{key:a,ref:t,code:r});if("object"==typeof t&&!(t instanceof RegExp))return[t.type||"string",t.validate,e._`${s}.validate`];return["string",t,s]}(o);i===r&&t.pass(function(){if("object"==typeof o&&!(o instanceof RegExp)&&o.async){if(!u.$async)throw new Error("async format in sync schema");return e._`await ${h}(${s})`}return"function"==typeof c?e._`${h}(${s})`:e._`${h}.test(${s})`}())}())}};return vr.default=t,vr}var $r,wr,_r={};function kr(){if(wr)return Be;wr=1,Object.defineProperty(Be,"__esModule",{value:!0});const e=Ye(),t=Nt(),r=mr(),n=function(){if(gr)return yr;gr=1,Object.defineProperty(yr,"__esModule",{value:!0});const e=[br().default];return yr.default=e,yr}(),s=($r||($r=1,Object.defineProperty(_r,"__esModule",{value:!0}),_r.contentVocabulary=_r.metadataVocabulary=void 0,_r.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"],_r.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]),_r),o=[e.default,t.default,(0,r.default)(),n.default,s.metadataVocabulary,s.contentVocabulary];return Be.default=o,Be}var Sr,Er,Ir={},xr={};function Nr(){if(Er)return Ir;Er=1,Object.defineProperty(Ir,"__esModule",{value:!0});const e=A(),t=(Sr||(Sr=1,Object.defineProperty(xr,"__esModule",{value:!0}),xr.DiscrError=void 0,function(e){e.Tag="tag",e.Mapping="mapping"}(r||(xr.DiscrError=r={}))),xr);var r;const n=Pe(),s=Ie(),o=D(),a={keyword:"discriminator",type:"object",schemaType:"object",error:{message:({params:{discrError:e,tagName:r}})=>e===t.DiscrError.Tag?`tag "${r}" must be string`:`value of tag "${r}" must be in oneOf`,params:({params:{discrError:t,tag:r,tagName:n}})=>e._`{error: ${t}, tag: ${n}, tagValue: ${r}}`},code(r){const{gen:a,data:i,schema:c,parentSchema:l,it:d}=r,{oneOf:u}=l;if(!d.opts.discriminator)throw new Error("discriminator: requires discriminator option");const p=c.propertyName;if("string"!=typeof p)throw new Error("discriminator: requires propertyName");if(c.mapping)throw new Error("discriminator: mapping is not supported");if(!u)throw new Error("discriminator: requires oneOf keyword");const h=a.let("valid",!1),m=a.const("tag",e._`${i}${(0,e.getProperty)(p)}`);function f(t){const n=a.name("valid"),s=r.subschema({keyword:"oneOf",schemaProp:t},n);return r.mergeEvaluated(s,e.Name),n}a.if(e._`typeof ${m} == "string"`,()=>function(){const i=function(){var e;const t={},r=i(l);let a=!0;for(let t=0;t<u.length;t++){let l=u[t];if((null==l?void 0:l.$ref)&&!(0,o.schemaHasRulesButRef)(l,d.self.RULES)){const e=l.$ref;if(l=n.resolveRef.call(d.self,d.schemaEnv.root,d.baseId,e),l instanceof n.SchemaEnv&&(l=l.schema),void 0===l)throw new s.default(d.opts.uriResolver,d.baseId,e)}const h=null===(e=null==l?void 0:l.properties)||void 0===e?void 0:e[p];if("object"!=typeof h)throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${p}"`);a=a&&(r||i(l)),c(h,t)}if(!a)throw new Error(`discriminator: "${p}" must be required`);return t;function i({required:e}){return Array.isArray(e)&&e.includes(p)}function c(e,t){if(e.const)h(e.const,t);else{if(!e.enum)throw new Error(`discriminator: "properties/${p}" must have "const" or "enum"`);for(const r of e.enum)h(r,t)}}function h(e,r){if("string"!=typeof e||e in t)throw new Error(`discriminator: "${p}" values must be unique strings`);t[e]=r}}();a.if(!1);for(const t in i)a.elseIf(e._`${m} === ${t}`),a.assign(h,f(i[t]));a.else(),r.error(!1,{discrError:t.DiscrError.Mapping,tag:m,tagName:p}),a.endIf()}(),()=>r.error(!1,{discrError:t.DiscrError.Tag,tag:m,tagName:p})),r.ok(h)}};return Ir.default=a,Ir}var Pr,Tr={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0};var jr=(Pr||(Pr=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRefError=t.ValidationError=t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=t.Ajv=void 0;const r=Fe(),n=kr(),s=Nr(),o=Tr,a=["/properties"],i="http://json-schema.org/draft-07/schema";class c extends r.default{_addVocabularies(){super._addVocabularies(),n.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(s.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const e=this.opts.$data?this.$dataMetaSchema(o,a):o;this.addMetaSchema(e,i,!1),this.refs["http://json-schema.org/schema"]=i}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(i)?i:void 0)}}t.Ajv=c,e.exports=t=c,e.exports.Ajv=c,Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var l=$e();Object.defineProperty(t,"KeywordCxt",{enumerable:!0,get:function(){return l.KeywordCxt}});var d=A();Object.defineProperty(t,"_",{enumerable:!0,get:function(){return d._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return d.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return d.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return d.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return d.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return d.CodeGen}});var u=ke();Object.defineProperty(t,"ValidationError",{enumerable:!0,get:function(){return u.default}});var p=Ie();Object.defineProperty(t,"MissingRefError",{enumerable:!0,get:function(){return p.default}})}(k,k.exports)),k.exports),Cr=w(jr);class Or{constructor(e={}){this.options=e}_getConfig(){const e=c.getAPIConfig();return{apiKey:this.options.apiKey||e.apiKey,baseURL:this.options.baseURL||e.baseURL,model:this.options.model||e.model}}async createChatCompletion(e){const{model:t,messages:r,tools:n,tool_choice:s,stream:o=!1}=e,a=this._getConfig();if(!a.apiKey)throw new Error("API Key not configured. Please inject config via AgentBridge.injectConfig()");if(!a.baseURL)throw new Error("API Base URL not configured. Please inject config via AgentBridge.injectConfig()");const i={model:t||a.model,messages:r,tools:n,tool_choice:s,stream:o},c=await fetch(`${a.baseURL}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify(i)});if(!c.ok){const e=await c.text();throw new Error(`API Error ${c.status}: ${e}`)}return c.json()}}const Rr="http://localhost:10002",Ar=[{name:"Xi'an Famous Foods",detail:"Spicy and savory hand-pulled noodles.",imageUrl:`${Rr}/static/shrimpchowmein.jpeg`,rating:"â˜…â˜…â˜…â˜…â˜†",infoLink:"[More Info](https://www.xianfoods.com/)",address:"81 St Marks Pl, New York, NY 10003"},{name:"Han Dynasty",detail:"Authentic Szechuan cuisine.",imageUrl:`${Rr}/static/mapotofu.jpeg`,rating:"â˜…â˜…â˜…â˜…â˜†",infoLink:"[More Info](https://www.handynasty.net/)",address:"90 3rd Ave, New York, NY 10003"},{name:"RedFarm",detail:"Modern Chinese with a farm-to-table approach.",imageUrl:`${Rr}/static/beefbroccoli.jpeg`,rating:"â˜…â˜…â˜…â˜…â˜†",infoLink:"[More Info](https://www.redfarmnyc.com/)",address:"529 Hudson St, New York, NY 10014"},{name:"Mott 32",detail:"Upscale Cantonese dining.",imageUrl:`${Rr}/static/springrolls.jpeg`,rating:"â˜…â˜…â˜…â˜…â˜…",infoLink:"[More Info](https://mott32.com/newyork/)",address:"111 W 57th St, New York, NY 10019"},{name:"Hwa Yuan Szechuan",detail:"Famous for its cold noodles with sesame sauce.",imageUrl:`${Rr}/static/kungpao.jpeg`,rating:"â˜…â˜…â˜…â˜…â˜†",infoLink:"[More Info](https://hwayuannyc.com/)",address:"40 E Broadway, New York, NY 10002"},{name:"Cafe China",detail:"Szechuan food in a 1930s Shanghai setting.",imageUrl:`${Rr}/static/mapotofu.jpeg`,rating:"â˜…â˜…â˜…â˜…â˜†",infoLink:"[More Info](https://www.cafechinanyc.com/)",address:"59 W 37th St, New York, NY 10018"},{name:"Philippe Chow",detail:"High-end Beijing-style cuisine.",imageUrl:`${Rr}/static/beefbroccoli.jpeg`,rating:"â˜…â˜…â˜…â˜…â˜†",infoLink:"[More Info](https://www.philippechow.com/)",address:"33 E 60th St, New York, NY 10022"},{name:"Chinese Tuxedo",detail:"Contemporary Chinese in a former opera house.",imageUrl:`${Rr}/static/mapotofu.jpeg`,rating:"â˜…â˜…â˜…â˜…â˜†",infoLink:"[More Info](https://chinesetuxedo.com/)",address:"5 Doyers St, New York, NY 10013"}];function Mr(e,t){const{cuisine:r,location:n,count:s=5}=e;console.info(`--- TOOL CALLED: getRestaurants (count: ${s}) ---`),console.info(`  - Cuisine: ${r}`),console.info(`  - Location: ${n}`);let o=[];if(n.toLowerCase().includes("new york")||n.toLowerCase().includes("ny"))try{const e=function(e){return e&&e!==Rr?Ar.map(t=>({...t,imageUrl:t.imageUrl.replace(Rr,e)})):Ar}(t?.state?.base_url||t?.state?.baseUrl);o=e.slice(0,s),console.info(`  - Success: Found ${e.length} restaurants, returning ${o.length}.`)}catch(e){console.error(`  - Error: ${e.message}`)}return JSON.stringify(o)}const Ur=[{type:"function",function:{name:"get_restaurants",description:"Call this tool to get a list of restaurants based on a cuisine and location. 'count' is the number of restaurants to return.",parameters:{type:"object",properties:{cuisine:{type:"string",description:"The type of cuisine to search for."},location:{type:"string",description:"The city or location for the restaurant search."},count:{type:"number",description:"Number of restaurant results to return."}},required:["cuisine","location"]}}}];var Dr,Lr;var qr=Lr?Dr:(Lr=1,Dr={RESTAURANT_UI_EXAMPLES:'---BEGIN SINGLE_COLUMN_LIST_EXAMPLE---\n[\n  {{ "beginRendering": {{ "surfaceId": "default", "root": "root-column", "styles": {{ "primaryColor": "#FF0000", "font": "Roboto" }} }} }},\n  {{ "surfaceUpdate": {{"surfaceId": "default", "components": [\n      {{ "id": "root-column", "component": {{ "Column": {{ "children": {{ "explicitList": ["title-heading", "item-list"] }} }} }} }},\n      {{ "id": "title-heading", "component": {{ "Text": {{ "usageHint": "h1", "text": {{ "path": "title" }} }} }} }},\n      {{ "id": "item-list", "component": {{ "List": {{ "direction": "vertical", "children": {{ "template": {{ "componentId": "item-card-template", "dataBinding": "/items" }} }} }} }} }},\n      {{ "id": "item-card-template", "component": {{ "Card": {{ "child": "card-layout" }} }} }},\n      {{ "id": "card-layout", "component": {{ "Row": {{ "children": {{ "explicitList": ["template-image", "card-details"] }} }} }} }},\n      {{ "id": "template-image", weight: 1, "component": {{ "Image": {{ "url": {{ "path": "imageUrl" }} }} }} }},\n      {{ "id": "card-details", weight: 2, "component": {{ "Column": {{ "children": {{ "explicitList": ["template-name", "template-rating", "template-detail", "template-link", "template-book-button"] }} }} }} }},\n      {{ "id": "template-name", "component": {{ "Text": {{ "usageHint": "h3", "text": {{ "path": "name" }} }} }} }},\n      {{ "id": "template-rating", "component": {{ "Text": {{ "text": {{ "path": "rating" }} }} }} }},\n      {{ "id": "template-detail", "component": {{ "Text": {{ "text": {{ "path": "detail" }} }} }} }},\n      {{ "id": "template-link", "component": {{ "Text": {{ "text": {{ "path": "infoLink" }} }} }} }},\n      {{ "id": "template-book-button", "component": {{ "Button": {{ "child": "book-now-text", "primary": true, "action": {{ "name": "book_restaurant", "context": [ {{ "key": "restaurantName", "value": {{ "path": "name" }} }}, {{ "key": "imageUrl", "value": {{ "path": "imageUrl" }} }}, {{ "key": "address", "value": {{ "path": "address" }} }} ] }} }} }} }},\n      {{ "id": "book-now-text", "component": {{ "Text": {{ "text": {{ "literalString": "Book Now" }} }} }} }}\n    ]\n  }} }},\n  {{ "dataModelUpdate": {{"surfaceId": "default", "path": "/", "contents": [\n      {{ "key": "items", "valueMap": [\n        {{ "key": "item1", "valueMap": [\n          {{ "key": "name", "valueString": "The Fancy Place" }},\n          {{ "key": "rating", "valueNumber": 4.8 }},\n          {{ "key": "detail", "valueString": "Fine dining experience" }},\n          {{ "key": "infoLink", "valueString": "https://example.com/fancy" }},\n          {{ "key": "imageUrl", "valueString": "https://example.com/fancy.jpg" }},\n          {{ "key": "address", "valueString": "123 Main St" }}\n        ] }},\n        {{ "key": "item2", "valueMap": [\n          {{ "key": "name", "valueString": "Quick Bites" }},\n          {{ "key": "rating", "valueNumber": 4.2 }},\n          {{ "key": "detail", "valueString": "Casual and fast" }},\n          {{ "key": "infoLink", "valueString": "https://example.com/quick" }},\n          {{ "key": "imageUrl", "valueString": "https://example.com/quick.jpg" }},\n          {{ "key": "address", "valueString": "456 Oak Ave" }}\n        ] }}\n      ] }} // Populate this with restaurant data\n    ]\n  }} }}\n]\n---END SINGLE_COLUMN_LIST_EXAMPLE---\n\n---BEGIN TWO_COLUMN_LIST_EXAMPLE---\n[\n  {{ "beginRendering": {{ "surfaceId": "default", "root": "root-column", "styles": {{ "primaryColor": "#FF0000", "font": "Roboto" }} }} }},\n  {{ "surfaceUpdate": {{"surfaceId": "default", "components": [\n      {{ "id": "root-column", "component": {{ "Column": {{ "children": {{ "explicitList": ["title-heading", "restaurant-row-1"] }} }} }} }},\n      {{ "id": "title-heading", "component": {{ "Text": {{ "usageHint": "h1", "text": {{ "path": "title" }} }} }} }},\n      {{ "id": "restaurant-row-1", "component": {{ "Row": {{ "children": {{ "explicitList": ["item-card-1", "item-card-2"] }} }} }} }},\n      {{ "id": "item-card-1", "weight": 1, "component": {{ "Card": {{ "child": "card-layout-1" }} }} }},\n      {{ "id": "card-layout-1", "component": {{ "Column": {{ "children": {{ "explicitList": ["template-image-1", "card-details-1"] }} }} }} }},\n      {{ "id": "template-image-1", "component": {{ "Image": {{ "url": {{ "path": "/items/0/imageUrl" }}, "width": "100%" }} }} }},\n      {{ "id": "card-details-1", "component": {{ "Column": {{ "children": {{ "explicitList": ["template-name-1", "template-rating-1", "template-detail-1", "template-link-1", "template-book-button-1"] }} }} }} }},\n      {{ "id": "template-name-1", "component": {{ "Text": {{ "usageHint": "h3", "text": {{ "path": "/items/0/name" }} }} }} }},\n      {{ "id": "template-rating-1", "component": {{ "Text": {{ "text": {{ "path": "/items/0/rating" }} }} }} }},\n      {{ "id": "template-detail-1", "component": {{ "Text": {{ "text": {{ "path": "/items/0/detail" }} }} }} }},\n      {{ "id": "template-link-1", "component": {{ "Text": {{ "text": {{ "path": "/items/0/infoLink" }} }} }} }},\n      {{ "id": "template-book-button-1", "component": {{ "Button": {{ "child": "book-now-text-1", "action": {{ "name": "book_restaurant", "context": [ {{ "key": "restaurantName", "value": {{ "path": "/items/0/name" }} }}, {{ "key": "imageUrl", "value": {{ "path": "/items/0/imageUrl" }} }}, {{ "key": "address", "value": {{ "path": "/items/0/address" }} }} ] }} }} }} }},\n      {{ "id": "book-now-text-1", "component": {{ "Text": {{ "text": {{ "literalString": "Book Now" }} }} }} }},\n      {{ "id": "item-card-2", "weight": 1, "component": {{ "Card": {{ "child": "card-layout-2" }} }} }},\n      {{ "id": "card-layout-2", "component": {{ "Column": {{ "children": {{ "explicitList": ["template-image-2", "card-details-2"] }} }} }} }},\n      {{ "id": "template-image-2", "component": {{ "Image": {{ "url": {{ "path": "/items/1/imageUrl" }}, "width": "100%" }} }} }},\n      {{ "id": "card-details-2", "component": {{ "Column": {{ "children": {{ "explicitList": ["template-name-2", "template-rating-2", "template-detail-2", "template-link-2", "template-book-button-2"] }} }} }} }},\n      {{ "id": "template-name-2", "component": {{ "Text": {{ "usageHint": "h3", "text": {{ "path": "/items/1/name" }} }} }} }},\n      {{ "id": "template-rating-2", "component": {{ "Text": {{ "text": {{ "path": "/items/1/rating" }} }} }} }},\n      {{ "id": "template-detail-2", "component": {{ "Text": {{ "text": {{ "path": "/items/1/detail" }} }} }} }},\n      {{ "id": "template-link-2", "component": {{ "Text": {{ "text": {{ "path": "/items/1/infoLink" }} }} }} }},\n      {{ "id": "template-book-button-2", "component": {{ "Button": {{ "child": "book-now-text-2", "action": {{ "name": "book_restaurant", "context": [ {{ "key": "restaurantName", "value": {{ "path": "/items/1/name" }} }}, {{ "key": "imageUrl", "value": {{ "path": "/items/1/imageUrl" }} }}, {{ "key": "address", "value": {{ "path": "/items/1/address" }} }} ] }} }} }} }},\n      {{ "id": "book-now-text-2", "component": {{ "Text": {{ "text": {{ "literalString": "Book Now" }} }} }} }}\n    ]\n  }} }},\n  {{ "dataModelUpdate": {{"surfaceId": "default", "path": "/", "contents": [\n      {{ "key": "title", "valueString": "Top Restaurants" }},\n      {{ "key": "items", "valueMap": [\n        {{ "key": "item1", "valueMap": [\n          {{ "key": "name", "valueString": "The Fancy Place" }},\n          {{ "key": "rating", "valueNumber": 4.8 }},\n          {{ "key": "detail", "valueString": "Fine dining experience" }},\n          {{ "key": "infoLink", "valueString": "https://example.com/fancy" }},\n          {{ "key": "imageUrl", "valueString": "https://example.com/fancy.jpg" }},\n          {{ "key": "address", "valueString": "123 Main St" }}\n        ] }},\n        {{ "key": "item2", "valueMap": [\n          {{ "key": "name", "valueString": "Quick Bites" }},\n          {{ "key": "rating", "valueNumber": 4.2 }},\n          {{ "key": "detail", "valueString": "Casual and fast" }},\n          {{ "key": "infoLink", "valueString": "https://example.com/quick" }},\n          {{ "key": "imageUrl", "valueString": "https://example.com/quick.jpg" }},\n          {{ "key": "address", "valueString": "456 Oak Ave" }}\n        ] }}\n      ] }} // Populate this with restaurant data\n    ]\n  }} }}\n]\n---END TWO_COLUMN_LIST_EXAMPLE---\n\n---BEGIN BOOKING_FORM_EXAMPLE---\n[\n  {{ "beginRendering": {{ "surfaceId": "booking-form", "root": "booking-form-column", "styles": {{ "primaryColor": "#FF0000", "font": "Roboto" }} }} }},\n  {{ "surfaceUpdate": {{"surfaceId": "booking-form", "components": [\n      {{ "id": "booking-form-column", "component": {{ "Column": {{ "children": {{ "explicitList": ["booking-title", "restaurant-image", "restaurant-address", "party-size-field", "datetime-field", "dietary-field", "submit-button"] }} }} }} }},\n      {{ "id": "booking-title", "component": {{ "Text": {{ "usageHint": "h2", "text": {{ "path": "title" }} }} }} }},\n      {{ "id": "restaurant-image", "component": {{ "Image": {{ "url": {{ "path": "imageUrl" }} }} }} }},\n      {{ "id": "restaurant-address", "component": {{ "Text": {{ "text": {{ "path": "address" }} }} }} }},\n      {{ "id": "party-size-field", "component": {{ "TextField": {{ "label": {{ "literalString": "Party Size" }}, "text": {{ "path": "partySize" }}, "type": "number" }} }} }},\n      {{ "id": "datetime-field", "component": {{ "DateTimeInput": {{ "label": {{ "literalString": "Date & Time" }}, "value": {{ "path": "reservationTime" }}, "enableDate": true, "enableTime": true }} }} }},\n      {{ "id": "dietary-field", "component": {{ "TextField": {{ "label": {{ "literalString": "Dietary Requirements" }}, "text": {{ "path": "dietary" }} }} }} }},\n      {{ "id": "submit-button", "component": {{ "Button": {{ "child": "submit-reservation-text", "action": {{ "name": "submit_booking", "context": [ {{ "key": "restaurantName", "value": {{ "path": "restaurantName" }} }}, {{ "key": "partySize", "value": {{ "path": "partySize" }} }}, {{ "key": "reservationTime", "value": {{ "path": "reservationTime" }} }}, {{ "key": "dietary", "value": {{ "path": "dietary" }} }}, {{ "key": "imageUrl", "value": {{ "path": "imageUrl" }} }} ] }} }} }} }},\n      {{ "id": "submit-reservation-text", "component": {{ "Text": {{ "text": {{ "literalString": "Submit Reservation" }} }} }} }}\n    ]\n  }} }},\n  {{ "dataModelUpdate": {{"surfaceId": "booking-form", "path": "/", "contents": [\n      {{ "key": "title", "valueString": "Book a Table at [RestaurantName]" }},\n      {{ "key": "address", "valueString": "[Restaurant Address]" }},\n      {{ "key": "restaurantName", "valueString": "[RestaurantName]" }},\n      {{ "key": "partySize", "valueString": "2" }},\n      {{ "key": "reservationTime", "valueString": "" }},\n      {{ "key": "dietary", "valueString": "" }},\n      {{ "key": "imageUrl", "valueString": "" }}\n    ]\n  }} }}\n]\n---END BOOKING_FORM_EXAMPLE---\n\n---BEGIN CONFIRMATION_EXAMPLE---\n[\n  {{ "beginRendering": {{ "surfaceId": "confirmation", "root": "confirmation-card", "styles": {{ "primaryColor": "#FF0000", "font": "Roboto" }} }} }},\n  {{ "surfaceUpdate": {{"surfaceId": "confirmation", "components": [\n      {{ "id": "confirmation-card", "component": {{ "Card": {{ "child": "confirmation-column" }} }} }},\n      {{ "id": "confirmation-column", "component": {{ "Column": {{ "children": {{ "explicitList": ["confirm-title", "confirm-image", "divider1", "confirm-details", "divider2", "confirm-dietary", "divider3", "confirm-text"] }} }} }} }},\n      {{ "id": "confirm-title", "component": {{ "Text": {{ "usageHint": "h2", "text": {{ "path": "title" }} }} }} }},\n      {{ "id": "confirm-image", "component": {{ "Image": {{ "url": {{ "path": "imageUrl" }} }} }} }},\n      {{ "id": "confirm-details", "component": {{ "Text": {{ "text": {{ "path": "bookingDetails" }} }} }} }},\n      {{ "id": "confirm-dietary", "component": {{ "Text": {{ "text": {{ "path": "dietaryRequirements" }} }} }} }},\n      {{ "id": "confirm-text", "component": {{ "Text": {{ "usageHint": "h5", "text": {{ "literalString": "We look forward to seeing you!" }} }} }} }},\n      {{ "id": "divider1", "component": {{ "Divider": {{}} }} }},\n      {{ "id": "divider2", "component": {{ "Divider": {{}} }} }},\n      {{ "id": "divider3", "component": {{ "Divider": {{}} }} }}\n    ]\n  }} }},\n  {{ "dataModelUpdate": {{"surfaceId": "confirmation", "path": "/", "contents": [\n      {{ "key": "title", "valueString": "Booking at [RestaurantName]" }},\n      {{ "key": "bookingDetails", "valueString": "[PartySize] people at [Time]" }},\n      {{ "key": "dietaryRequirements", "valueString": "Dietary Requirements: [Requirements]" }},\n      {{ "key": "imageUrl", "valueString": "[ImageUrl]" }}\n    ]\n  }} }}\n]\n---END CONFIRMATION_EXAMPLE---'});const zr=JSON.stringify({title:"A2UI Message Schema",description:"Describes a JSON payload for an A2UI (Agent to UI) message, which is used to dynamically construct and update user interfaces. A message MUST contain exactly ONE of the action properties: 'beginRendering', 'surfaceUpdate', 'dataModelUpdate', or 'deleteSurface'.",type:"object",properties:{beginRendering:{type:"object",description:"Signals the client to begin rendering a surface with a root component and specific styles.",properties:{surfaceId:{type:"string",description:"The unique identifier for the UI surface to be rendered."},root:{type:"string",description:"The ID of the root component to render."},styles:{type:"object",description:"Styling information for the UI.",properties:{font:{type:"string",description:"The primary font for the UI."},primaryColor:{type:"string",description:"The primary UI color as a hexadecimal code (e.g., '#00BFFF').",pattern:"^#[0-9a-fA-F]{6}$"}}}},required:["root","surfaceId"]},surfaceUpdate:{type:"object",description:"Updates a surface with a new set of components.",properties:{surfaceId:{type:"string",description:"The unique identifier for the UI surface to be updated. If you are adding a new surface this *must* be a new, unique identified that has never been used for any existing surfaces shown."},components:{type:"array",description:"A list containing all UI components for the surface.",minItems:1,items:{type:"object",description:"Represents a *single* component in a UI widget tree. This component could be one of many supported types.",properties:{id:{type:"string",description:"The unique identifier for this component."},weight:{type:"number",description:"The relative weight of this component within a Row or Column. This corresponds to the CSS 'flex-grow' property. Note: this may ONLY be set when the component is a direct descendant of a Row or Column."},component:{type:"object",description:"A wrapper object that MUST contain exactly one key, which is the name of the component type (e.g., 'Heading'). The value is an object containing the properties for that specific component.",properties:{Text:{type:"object",properties:{text:{type:"object",description:"The text content to display. This can be a literal string or a reference to a value in the data model ('path', e.g., '/doc/title'). While simple Markdown formatting is supported (i.e. without HTML, images, or links), utilizing dedicated UI components is generally preferred for a richer and more structured presentation.",properties:{literalString:{type:"string"},path:{type:"string"}}},usageHint:{type:"string",description:"A hint for the base text style. One of:\n- `h1`: Largest heading.\n- `h2`: Second largest heading.\n- `h3`: Third largest heading.\n- `h4`: Fourth largest heading.\n- `h5`: Fifth largest heading.\n- `caption`: Small text for captions.\n- `body`: Standard body text.",enum:["h1","h2","h3","h4","h5","caption","body"]}},required:["text"]},Image:{type:"object",properties:{url:{type:"object",description:"The URL of the image to display. This can be a literal string ('literal') or a reference to a value in the data model ('path', e.g. '/thumbnail/url').",properties:{literalString:{type:"string"},path:{type:"string"}}},fit:{type:"string",description:"Specifies how the image should be resized to fit its container. This corresponds to the CSS 'object-fit' property.",enum:["contain","cover","fill","none","scale-down"]},usageHint:{type:"string",description:"A hint for the image size and style. One of:\n- `icon`: Small square icon.\n- `avatar`: Circular avatar image.\n- `smallFeature`: Small feature image.\n- `mediumFeature`: Medium feature image.\n- `largeFeature`: Large feature image.\n- `header`: Full-width, full bleed, header image.",enum:["icon","avatar","smallFeature","mediumFeature","largeFeature","header"]}},required:["url"]},Icon:{type:"object",properties:{name:{type:"object",description:"The name of the icon to display. This can be a literal string or a reference to a value in the data model ('path', e.g. '/form/submit').",properties:{literalString:{type:"string",enum:["accountCircle","add","arrowBack","arrowForward","attachFile","calendarToday","call","camera","check","close","delete","download","edit","event","error","favorite","favoriteOff","folder","help","home","info","locationOn","lock","lockOpen","mail","menu","moreVert","moreHoriz","notificationsOff","notifications","payment","person","phone","photo","print","refresh","search","send","settings","share","shoppingCart","star","starHalf","starOff","upload","visibility","visibilityOff","warning"]},path:{type:"string"}}}},required:["name"]},Video:{type:"object",properties:{url:{type:"object",description:"The URL of the video to display. This can be a literal string or a reference to a value in the data model ('path', e.g. '/video/url').",properties:{literalString:{type:"string"},path:{type:"string"}}}},required:["url"]},AudioPlayer:{type:"object",properties:{url:{type:"object",description:"The URL of the audio to be played. This can be a literal string ('literal') or a reference to a value in the data model ('path', e.g. '/song/url').",properties:{literalString:{type:"string"},path:{type:"string"}}},description:{type:"object",description:"A description of the audio, such as a title or summary. This can be a literal string or a reference to a value in the data model ('path', e.g. '/song/title').",properties:{literalString:{type:"string"},path:{type:"string"}}}},required:["url"]},Row:{type:"object",properties:{children:{type:"object",description:"Defines the children. Use 'explicitList' for a fixed set of children, or 'template' to generate children from a data list.",properties:{explicitList:{type:"array",items:{type:"string"}},template:{type:"object",description:"A template for generating a dynamic list of children from a data model list. `componentId` is the component to use as a template, and `dataBinding` is the path to the map of components in the data model. Values in the map will define the list of children.",properties:{componentId:{type:"string"},dataBinding:{type:"string"}},required:["componentId","dataBinding"]}}},distribution:{type:"string",description:"Defines the arrangement of children along the main axis (horizontally). This corresponds to the CSS 'justify-content' property.",enum:["center","end","spaceAround","spaceBetween","spaceEvenly","start"]},alignment:{type:"string",description:"Defines the alignment of children along the cross axis (vertically). This corresponds to the CSS 'align-items' property.",enum:["start","center","end","stretch"]}},required:["children"]},Column:{type:"object",properties:{children:{type:"object",description:"Defines the children. Use 'explicitList' for a fixed set of children, or 'template' to generate children from a data list.",properties:{explicitList:{type:"array",items:{type:"string"}},template:{type:"object",description:"A template for generating a dynamic list of children from a data model list. `componentId` is the component to use as a template, and `dataBinding` is the path to the map of components in the data model. Values in the map will define the list of children.",properties:{componentId:{type:"string"},dataBinding:{type:"string"}},required:["componentId","dataBinding"]}}},distribution:{type:"string",description:"Defines the arrangement of children along the main axis (vertically). This corresponds to the CSS 'justify-content' property.",enum:["start","center","end","spaceBetween","spaceAround","spaceEvenly"]},alignment:{type:"string",description:"Defines the alignment of children along the cross axis (horizontally). This corresponds to the CSS 'align-items' property.",enum:["center","end","start","stretch"]}},required:["children"]},List:{type:"object",properties:{children:{type:"object",description:"Defines the children. Use 'explicitList' for a fixed set of children, or 'template' to generate children from a data list.",properties:{explicitList:{type:"array",items:{type:"string"}},template:{type:"object",description:"A template for generating a dynamic list of children from a data model list. `componentId` is the component to use as a template, and `dataBinding` is the path to the map of components in the data model. Values in the map will define the list of children.",properties:{componentId:{type:"string"},dataBinding:{type:"string"}},required:["componentId","dataBinding"]}}},direction:{type:"string",description:"The direction in which the list items are laid out.",enum:["vertical","horizontal"]},alignment:{type:"string",description:"Defines the alignment of children along the cross axis.",enum:["start","center","end","stretch"]}},required:["children"]},Card:{type:"object",properties:{child:{type:"string",description:"The ID of the component to be rendered inside the card."}},required:["child"]},Tabs:{type:"object",properties:{tabItems:{type:"array",description:"An array of objects, where each object defines a tab with a title and a child component.",items:{type:"object",properties:{title:{type:"object",description:"The tab title. Defines the value as either a literal value or a path to data model value (e.g. '/options/title').",properties:{literalString:{type:"string"},path:{type:"string"}}},child:{type:"string"}},required:["title","child"]}}},required:["tabItems"]},Divider:{type:"object",properties:{axis:{type:"string",description:"The orientation of the divider.",enum:["horizontal","vertical"]}}},Modal:{type:"object",properties:{entryPointChild:{type:"string",description:"The ID of the component that opens the modal when interacted with (e.g., a button)."},contentChild:{type:"string",description:"The ID of the component to be displayed inside the modal."}},required:["entryPointChild","contentChild"]},Button:{type:"object",properties:{child:{type:"string",description:"The ID of the component to display in the button, typically a Text component."},primary:{type:"boolean",description:"Indicates if this button should be styled as the primary action."},action:{type:"object",description:"The client-side action to be dispatched when the button is clicked. It includes the action's name and an optional context payload.",properties:{name:{type:"string"},context:{type:"array",items:{type:"object",properties:{key:{type:"string"},value:{type:"object",description:"Defines the value to be included in the context as either a literal value or a path to a data model value (e.g. '/user/name').",properties:{path:{type:"string"},literalString:{type:"string"},literalNumber:{type:"number"},literalBoolean:{type:"boolean"}}}},required:["key","value"]}}},required:["name"]}},required:["child","action"]},CheckBox:{type:"object",properties:{label:{type:"object",description:"The text to display next to the checkbox. Defines the value as either a literal value or a path to data model ('path', e.g. '/option/label').",properties:{literalString:{type:"string"},path:{type:"string"}}},value:{type:"object",description:"The current state of the checkbox (true for checked, false for unchecked). This can be a literal boolean ('literalBoolean') or a reference to a value in the data model ('path', e.g. '/filter/open').",properties:{literalBoolean:{type:"boolean"},path:{type:"string"}}}},required:["label","value"]},TextField:{type:"object",properties:{label:{type:"object",description:"The text label for the input field. This can be a literal string or a reference to a value in the data model ('path, e.g. '/user/name').",properties:{literalString:{type:"string"},path:{type:"string"}}},text:{type:"object",description:"The value of the text field. This can be a literal string or a reference to a value in the data model ('path', e.g. '/user/name').",properties:{literalString:{type:"string"},path:{type:"string"}}},textFieldType:{type:"string",description:"The type of input field to display.",enum:["date","longText","number","shortText","obscured"]},validationRegexp:{type:"string",description:"A regular expression used for client-side validation of the input."}},required:["label"]},DateTimeInput:{type:"object",properties:{value:{type:"object",description:"The selected date and/or time value in ISO 8601 format. This can be a literal string ('literalString') or a reference to a value in the data model ('path', e.g. '/user/dob').",properties:{literalString:{type:"string"},path:{type:"string"}}},enableDate:{type:"boolean",description:"If true, allows the user to select a date."},enableTime:{type:"boolean",description:"If true, allows the user to select a time."}},required:["value"]},MultipleChoice:{type:"object",properties:{selections:{type:"object",description:"The currently selected values for the component. This can be a literal array of strings or a path to an array in the data model('path', e.g. '/hotel/options').",properties:{literalArray:{type:"array",items:{type:"string"}},path:{type:"string"}}},options:{type:"array",description:"An array of available options for the user to choose from.",items:{type:"object",properties:{label:{type:"object",description:"The text to display for this option. This can be a literal string or a reference to a value in the data model (e.g. '/option/label').",properties:{literalString:{type:"string"},path:{type:"string"}}},value:{type:"string",description:"The value to be associated with this option when selected."}},required:["label","value"]}},maxAllowedSelections:{type:"integer",description:"The maximum number of options that the user is allowed to select."}},required:["selections","options"]},Slider:{type:"object",properties:{value:{type:"object",description:"The current value of the slider. This can be a literal number ('literalNumber') or a reference to a value in the data model ('path', e.g. '/restaurant/cost').",properties:{literalNumber:{type:"number"},path:{type:"string"}}},minValue:{type:"number",description:"The minimum value of the slider."},maxValue:{type:"number",description:"The maximum value of the slider."}},required:["value"]}}}},required:["id","component"]}}},required:["surfaceId","components"]},dataModelUpdate:{type:"object",description:"Updates the data model for a surface.",properties:{surfaceId:{type:"string",description:"The unique identifier for the UI surface this data model update applies to."},path:{type:"string",description:"An optional path to a location within the data model (e.g., '/user/name'). If omitted, or set to '/', the entire data model will be replaced."},contents:{type:"array",description:"An array of data entries. Each entry must contain a 'key' and exactly one corresponding typed 'value*' property.",items:{type:"object",description:"A single data entry. Exactly one 'value*' property should be provided alongside the key.",properties:{key:{type:"string",description:"The key for this data entry."},valueString:{type:"string"},valueNumber:{type:"number"},valueBoolean:{type:"boolean"},valueMap:{description:"Represents a map as an adjacency list.",type:"array",items:{type:"object",description:"One entry in the map. Exactly one 'value*' property should be provided alongside the key.",properties:{key:{type:"string"},valueString:{type:"string"},valueNumber:{type:"number"},valueBoolean:{type:"boolean"}},required:["key"]}}},required:["key"]}}},required:["contents","surfaceId"]},deleteSurface:{type:"object",description:"Signals the client to delete the surface identified by 'surfaceId'.",properties:{surfaceId:{type:"string",description:"The unique identifier for the UI surface to be deleted."}},required:["surfaceId"]}}});const Fr=new Cr,Vr=new Map;class Br{constructor(e,t=!1){this.baseUrl=e,this.useUI=t,this.openai=new Or,this.a2uiSchemaObject=this._initSchema()}_initSchema(){try{return{type:"array",items:JSON.parse(zr)}}catch(e){return logger.error(`CRITICAL: Failed to parse A2UI_SCHEMA: ${e.message}`),null}}async _executeTool(e,t){const{name:r,arguments:n}=e.function,s=JSON.parse(n),o={state:t};return console.info(`--- Executing Tool: ${r} ---`),function(e,t,r){return"get_restaurants"===e?Mr(t,r):JSON.stringify({error:`Tool ${e} not found`})}(r,s,o)}async*stream(e,t){if(!Vr.has(t)){const e=this.useUI?"\n    You are a helpful restaurant finding assistant. Your goal is to help users find and book restaurants using a rich UI.\n\n    To achieve this, you MUST follow this logic:\n\n    1.  **For finding restaurants:**\n        a. You MUST call the 'get_restaurants' tool. Extract the cuisine, location, and a specific number ('count') of restaurants from the user's query.\n        b. After receiving the data, you MUST follow the instructions precisely to generate the final a2ui UI JSON, using the appropriate UI example from the prompt.\n\n    2.  **For booking a table:**\n        a. You MUST use the appropriate UI example to generate the booking UI.\n\n    3.  **For confirming a booking:**\n        a. You MUST use the confirmation UI example.\n"+function(e,t){let r=t;return e&&(r=t.replace(/\{\{\s*base_url\s*\}\}/g,e)),`\n    You are a helpful restaurant finding assistant. Your final output MUST be a a2ui UI JSON response.\n\n    To generate the response, you MUST follow these rules:\n    1.  Your response MUST be in two parts, separated by the delimiter: \`---a2ui_JSON---\`.\n    2.  The first part is your conversational text response.\n    3.  The second part is a single, raw JSON object which is a list of A2UI messages.\n    4.  The JSON part MUST validate against the A2UI JSON SCHEMA provided below.\n\n    --- UI TEMPLATE RULES ---\n    -   If the query is for a list of restaurants, use the restaurant data you have already received from the \`get_restaurants\` tool to populate the \`dataModelUpdate.contents\` array (e.g., as a \`valueMap\` for the "items" key).\n    -   If the number of restaurants is 5 or fewer, you MUST use the \`SINGLE_COLUMN_LIST_EXAMPLE\` template.\n    -   If the number of restaurants is more than 5, you MUST use the \`TWO_COLUMN_LIST_EXAMPLE\` template.\n    -   If the query is to book a restaurant (e.g., "USER_WANTS_TO_BOOK..."), you MUST use the \`BOOKING_FORM_EXAMPLE\` template.\n    -   If the query is a booking submission (e.g., "User submitted a booking..."), you MUST use the \`CONFIRMATION_EXAMPLE\` template.\n\n    ${r}\n\n    ---BEGIN A2UI JSON SCHEMA---\n    ${zr}\n    ---END A2UI JSON SCHEMA---\n    `}(this.baseUrl,qr.RESTAURANT_UI_EXAMPLES):"\n    You are a helpful restaurant finding assistant. Your final output MUST be a text response.\n\n    To generate the response, you MUST follow these rules:\n    1.  **For finding restaurants:**\n        a. You MUST call the `get_restaurants` tool. Extract the cuisine, location, and a specific number (`count`) of restaurants from the user's query.\n        b. After receiving the data, format the restaurant list as a clear, human-readable text response. You MUST preserve any markdown formatting (like for links) that you receive from the tool.\n\n    2.  **For booking a table (when you receive a query like 'USER_WANTS_TO_BOOK...'):**\n        a. Respond by asking the user for the necessary details to make a booking (party size, date, time, dietary requirements).\n\n    3.  **For confirming a booking (when you receive a query like 'User submitted a booking...'):**\n        a. Respond with a simple text confirmation of the booking details.\n    ";Vr.set(t,{messages:[{role:"system",content:e}],state:{base_url:this.baseUrl}})}const r=Vr.get(t);let n=r.messages;n.push({role:"user",content:e});let s=0;for(;s<=1;){s++,console.info(`--- Attempt ${s}/2 for ${t} ---`);try{let t=!0,o=null;for(;t;){yield{is_task_complete:!1,updates:"Finding restaurants that match your criteria..."};const e=c.getAPIConfig(),s=(await this.openai.createChatCompletion({model:e.model,messages:n,tools:Ur,tool_choice:"auto"})).choices[0].message;if(s.tool_calls){n.push(s);for(const e of s.tool_calls){const t=await this._executeTool(e,r.state);n.push({role:"tool",tool_call_id:e.id,content:t})}}else o=s.content,t=!1}if(!this.useUI)return n.push({role:"assistant",content:o}),void(yield{is_task_complete:!0,content:o});{const t=this._validateUI(o);if(t.ok)return n.push({role:"assistant",content:o}),void(yield{is_task_complete:!0,content:o});if(console.error(`Invalid UI Response: ${t.error}`),s<=1){const r=`Your previous response was invalid. ${t.error} Please retry the original request: '${e}'`;n.push({role:"user",content:r});continue}}}catch(e){return console.error("Stream Loop Error:",e),void(yield{is_task_complete:!0,content:"I'm sorry, I encountered an error."})}}yield{is_task_complete:!0,content:"I'm sorry, I'm having trouble generating the interface."}}_validateUI(e){try{if(!e||!e.includes("---a2ui_JSON---"))throw new Error("Delimiter '---a2ui_JSON---' not found.");const t=e.split("---a2ui_JSON---")[1].trim().replace(/^```json/,"").replace(/```$/,"").trim(),r=JSON.parse(t),n=Fr.compile(this.a2uiSchemaObject);return n(r)?{ok:!0}:{ok:!1,error:Fr.errorsText(n.errors)}}catch(e){return{ok:!1,error:e.message}}}}class Hr{constructor(e){this.uiAgent=new Br(e,!0),this.textAgent=new Br(e,!1)}async execute(e,t){let r="",n=null,s=null;console.info(`--- Client requested extensions: ${e.context?.requestedExtensions||[]} ---`);const o=(a=e.context,!!a?.requestedExtensions&&a.requestedExtensions.includes(l));var a;console.info(`--- AGENT_EXECUTOR: A2UI extension is ${o?"active":"not active"} ---`);const i=o?this.uiAgent:this.textAgent;if(e.userMessage&&e.userMessage.parts){console.info(`--- Processing ${e.userMessage.parts.length} message parts ---`);for(let t=0;t<e.userMessage.parts.length;t++){const r=e.userMessage.parts[t];"data"===r.kind?r.data&&"userAction"in r.data?(console.info(`  Part ${t}: Found a2ui UI ClientEvent payload.`),n=r.data.userAction):console.info(`  Part ${t}: DataPart`):"text"===r.kind&&console.info(`  Part ${t}: TextPart (${r.text.substring(0,50)}...)`)}}if(n){console.info(`Received a2ui ClientEvent: ${JSON.stringify(n)}`),s=n.actionName;const e=n.context||{};if("book_restaurant"===s){r=`USER_WANTS_TO_BOOK: ${e.restaurantName||"Unknown Restaurant"}, Address: ${e.address||"Address not provided"}, ImageURL: ${e.imageUrl||""}`}else if("submit_booking"===s){r=`User submitted a booking for ${e.restaurantName||"Unknown Restaurant"} for ${e.partySize||"Unknown Size"} people at ${e.reservationTime||"Unknown Time"} with dietary requirements: ${e.dietary||"None"}`}else r=`User event: ${s} with data: ${JSON.stringify(e)}`}else r=e.userMessage.parts.filter(e=>"text"===e.kind).map(e=>e.text).join(" ");console.info(`--- Final query for LLM: '${r.substring(0,100)}...' ---`);let c=e.task;c||(c={id:e.taskId,contextId:e.contextId,status:{state:"working",timestamp:(new Date).toISOString()},history:[e.userMessage],kind:"task"},t.publish(c));try{for await(const e of i.stream(r,c.contextId)){if(!e.is_task_complete){const r={kind:"status-update",taskId:c.id,contextId:c.contextId,status:{state:"working",message:{kind:"message",role:"agent",messageId:`agent-msg-${Date.now()}`,parts:[{kind:"text",text:e.updates}],taskId:c.id,contextId:c.contextId},timestamp:(new Date).toISOString()},final:!1};t.publish(r);continue}const r="submit_booking"===s?"completed":"input_required",n=e.content,o=[];if(n&&n.includes("---a2ui_JSON---")){const[e,t]=n.split("---a2ui_JSON---",2);if(e?.trim()&&o.push({kind:"text",text:e.trim()}),t?.trim())try{const e=t.trim().replace(/^```json/,"").replace(/```$/,"").trim(),r=JSON.parse(e);if(Array.isArray(r))for(const e of r)o.push(d(e));else o.push(d(r))}catch(e){console.error(`Failed to parse UI JSON: ${e}`),o.push({kind:"text",text:t})}}else o.push({kind:"text",text:n?.trim()||""});const a={kind:"status-update",taskId:c.id,contextId:c.contextId,status:{state:r,message:{kind:"message",role:"agent",messageId:`agent-final-${Date.now()}`,parts:o,taskId:c.id,contextId:c.contextId},timestamp:(new Date).toISOString()},final:"completed"===r};t.publish(a);break}}catch(e){console.error("Agent execution failed:",e);const r={kind:"status-update",taskId:c.id,contextId:c.contextId,status:{state:"failed",message:{kind:"message",role:"agent",messageId:`agent-error-${Date.now()}`,parts:[{kind:"text",text:`Agent execution failed: ${e.message}`}],taskId:c.id,contextId:c.contextId},timestamp:(new Date).toISOString()},final:!0};t.publish(r)}finally{t.finished()}}async cancelTask(e,t){const r={kind:"status-update",taskId:e,contextId:e,status:{state:"canceled",message:{kind:"message",role:"agent",messageId:`agent-cancel-${Date.now()}`,parts:[{kind:"text",text:"Task canceled by user"}],taskId:e,contextId:e},timestamp:(new Date).toISOString()},final:!0};t.publish(r),t.finished()}}var Kr=Object.freeze({__proto__:null,RestaurantAgentExecutor:Hr,default:Hr});return $}();
//# sourceMappingURL=agent-webview.js.map
